<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalOtvet</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #ff5700;
            --secondary-color: #f8f9fa;
            --dark-color: #1a1a1b;
            --light-color: #ffffff;
            --gray-color: #878a8c;
            --border-color: #ccc;
            --danger-color: #dc3545;
            --owner-color: #ffd700;
            --banned-color: #6c757d;
            --local-color: #4CAF50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--secondary-color);
            color: var(--dark-color);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        header {
            background-color: var(--light-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        .logo svg {
            margin-right: 10px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: var(--dark-color);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        nav ul li a:hover, 
        nav ul li a.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* –ì–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .app-container {
            display: flex;
            margin-top: 20px;
            gap: 20px;
            min-height: 80vh;
        }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å */
        .sidebar {
            width: 300px;
            background-color: var(--light-color);
            border-radius: 4px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .create-post-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .create-post-btn:hover {
            opacity: 0.9;
        }
        
        .create-post-btn:disabled {
            background-color: var(--banned-color);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .user-profile {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .user-avatar.banned {
            background-color: var(--banned-color);
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .username.banned {
            color: var(--banned-color);
            text-decoration: line-through;
        }

        .user-status {
            font-size: 12px;
            color: var(--gray-color);
        }
        
        .banned-badge {
            background-color: var(--banned-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }

        .change-username-btn {
            background: none;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .change-username-btn:disabled {
            border-color: var(--banned-color);
            color: var(--banned-color);
            cursor: not-allowed;
        }

        .change-username-btn:hover:not(:disabled) {
            background-color: var(--primary-color);
            color: white;
        }
        
        .user-id-display {
            font-size: 10px;
            color: var(--gray-color);
            margin-top: 2px;
            font-family: monospace;
        }

        .owner-badge {
            background-color: var(--owner-color);
            color: #000;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .categories {
            margin-top: 20px;
        }
        
        .categories h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .category-list {
            list-style: none;
        }
        
        .category-item {
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-item:hover {
            background-color: #f0f0f0;
        }
        
        .category-item.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .community-rules {
            margin-top: 20px;
        }
        
        .community-rules h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .community-rules ul {
            padding-left: 20px;
            color: var(--gray-color);
            font-size: 14px;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .main-content {
            flex: 1;
            display: none;
        }
        
        .main-content.active {
            display: block;
        }
        
        .posts-container {
            background-color: var(--light-color);
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .post {
            background-color: var(--light-color);
            border-radius: 4px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .post.banned {
            opacity: 0.7;
            border-left: 4px solid var(--banned-color);
        }
        
        .post.local-post {
            border-left: 4px solid var(--local-color);
            background-color: #f9fff9;
        }
        
        .post-header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border-bottom: 1px solid var(--border-color);
        }
        
        .post-category {
            background-color: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .post-votes {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 10px;
        }
        
        .vote-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--gray-color);
        }
        
        .vote-btn:hover:not(:disabled) {
            color: var(--primary-color);
        }
        
        .vote-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .vote-count {
            font-weight: bold;
            margin: 5px 0;
        }
        
        .post-content {
            padding: 15px;
        }
        
        .post-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        
        .post-text {
            margin-bottom: 15px;
            line-height: 1.5;
            color: var(--dark-color);
        }
        
        .post-footer {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-top: 1px solid var(--border-color);
            color: var(--gray-color);
            font-size: 14px;
        }
        
        .post-actions {
            display: flex;
            gap: 10px;
        }
        
        .comments-btn, .delete-post-btn, .ban-user-btn {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .comments-btn svg, .delete-post-btn svg, .ban-user-btn svg {
            margin-right: 5px;
        }
        
        .comments-btn:hover:not(:disabled) {
            color: var(--primary-color);
        }
        
        .comments-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .delete-post-btn {
            color: var(--danger-color);
        }

        .delete-post-btn.owner-delete {
            background-color: var(--owner-color);
            color: #000;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .delete-post-btn:hover:not(:disabled) {
            color: #bd2130;
        }
        
        .delete-post-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .ban-user-btn {
            color: var(--banned-color);
        }
        
        .ban-user-btn:hover:not(:disabled) {
            color: #495057;
        }
        
        .ban-user-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .comments-section {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: none;
        }
        
        .comment {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .comment:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .comment-header {
            font-size: 12px;
            color: var(--gray-color);
            margin-bottom: 5px;
        }
        
        .comment-text {
            line-height: 1.4;
        }
        
        .add-comment {
            margin-top: 15px;
        }
        
        .comment-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 10px;
        }
        
        .comment-textarea:disabled {
            background-color: #f8f9fa;
            cursor: not-allowed;
        }
        
        .submit-comment-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .submit-comment-btn:disabled {
            background-color: var(--banned-color);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ "–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ" */
        .popular-posts {
            background-color: var(--light-color);
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ "–°–æ–æ–±—â–µ—Å—Ç–≤–∞" */
        .communities-content {
            background-color: var(--light-color);
            border-radius: 4px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .communities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .community-card {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            border: 1px solid var(--border-color);
            cursor: pointer;
        }
        
        .community-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .community-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: white;
            font-size: 24px;
        }
        
        .community-stats {
            display: flex;
            margin-top: 15px;
            font-size: 14px;
            color: var(--gray-color);
        }
        
        .community-stats span {
            margin-right: 15px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞ "–û –ø—Ä–æ–µ–∫—Ç–µ" */
        .about-content {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .about-section {
            margin-bottom: 30px;
        }
        
        .about-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .feature-list {
            list-style: none;
            padding-left: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .feature-list li:before {
            content: "‚úì ";
            color: var(--primary-color);
            font-weight: bold;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 4px;
            width: 90%;
            max-width: 500px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        
        /* –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∞–Ω–Ω—ã—Ö */
        .data-tools {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        
        .data-tools h3 {
            margin-bottom: 10px;
        }
        
        .data-tools-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .import-export-btn {
            padding: 8px 15px;
            background-color: #4f4f4f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            flex: 1;
            min-width: 120px;
        }

        .owner-tools {
            margin-top: 15px;
            padding: 15px;
            background-color: #fff8e1;
            border-radius: 4px;
            border-left: 4px solid var(--owner-color);
        }
        
        .owner-tools h3 {
            color: #b8860b;
            margin-bottom: 10px;
        }
        
        .owner-btn {
            background-color: var(--owner-color);
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .sync-status {
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }
        
        .sync-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .sync-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* –ë–µ–π–¥–∂–∏ –¥–ª—è –ø–æ—Å—Ç–æ–≤ */
        .local-badge {
            background-color: var(--local-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .security-alert {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
            color: #856404;
        }
        
        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤ */
        .real-stats {
            font-size: 12px;
            color: var(--gray-color);
            margin-top: 5px;
        }
        
        .live-badge {
            background-color: #4CAF50;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–∞–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü—ã */
        .ban-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        
        .ban-message {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .ban-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .communities-grid {
                grid-template-columns: 1fr;
            }
            
            nav ul li {
                margin-left: 10px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            nav ul {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- –ë–∞–Ω-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
    <div id="banPage" class="ban-container" style="display: none;">
        <div class="ban-message">
            <div class="ban-icon">üö´</div>
            <h2>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h2>
            <p>–í–∞—à IP-–∞–¥—Ä–µ—Å –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.</p>
            <p>–ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —ç—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ –ø–æ –æ—à–∏–±–∫–µ, —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–µ–π —Å–∞–π—Ç–∞.</p>
            <div style="margin-top: 20px; font-size: 12px; opacity: 0.7;">
                IP: <span id="bannedIPDisplay"></span>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div id="mainApp">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo" id="homeBtn">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="#ff5700">
                            <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.74c.69 0 1.25.56 1.25 1.25a1.25 1.25 0 0 1-2.5 0c0-.69.56-1.25 1.25-1.25zm-4.41 3.08c0-2.42 1.72-4.44 4.42-4.44s4.42 2.02 4.42 4.44c0 1.13-.37 2.37-1.03 3.43-.65 1.06-1.5 1.95-2.47 2.62-1.55 1.07-3.22 1.64-4.92 1.64-1.7 0-3.37-.57-4.92-1.64-.97-.67-1.82-1.56-2.47-2.62-.66-1.06-1.03-2.3-1.03-3.43 0-2.42 1.72-4.44 4.42-4.44s4.42 2.02 4.42 4.44zm-7.6 0c0-1.5.65-2.74 1.98-3.72 1.33-.98 3.01-1.48 4.96-1.48 1.95 0 3.63.5 4.96 1.48 1.33.98 1.98 2.22 1.98 3.72 0 1.5-.65 2.74-1.98 3.72-1.33.98-3.01 1.48-4.96 1.48-1.95 0-3.63-.5-4.96-1.48-1.33-.98-1.98-2.22-1.98-3.72z"/>
                        </svg>
                        LocalOtvet
                    </div>
                    <nav>
                        <ul>
                            <li><a href="#" class="nav-link active" data-page="home">–ì–ª–∞–≤–Ω–∞—è</a></li>
                            <li><a href="#" class="nav-link" data-page="popular">–ü–æ–ø—É–ª—è—Ä–Ω–æ–µ</a></li>
                            <li><a href="#" class="nav-link" data-page="communities">–°–æ–æ–±—â–µ—Å—Ç–≤–∞</a></li>
                            <li><a href="#" class="nav-link" data-page="about">–û –ø—Ä–æ–µ–∫—Ç–µ</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="app-container">
                <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å (–≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π) -->
                <div class="sidebar" id="sidebar">
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div class="user-info">
                            <div class="username" id="usernameDisplay">–ê–Ω–æ–Ω–∏–º</div>
                            <div class="user-status">–£—á–∞—Å—Ç–Ω–∏–∫</div>
                            <div class="user-id-display" id="userIdDisplay">ID: –∑–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                        <button class="change-username-btn" id="changeUsernameBtn">–ò–∑–º–µ–Ω–∏—Ç—å</button>
                    </div>

                    <button class="create-post-btn" id="createPostBtn">–°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç</button>
                    
                    <div class="sync-status" id="syncStatus"></div>
                    
                    <div class="owner-tools" id="ownerTools" style="display: none;">
                        <h3>üëë –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≤–ª–∞–¥–µ–ª—å—Ü–∞</h3>
                        <button class="owner-btn" id="nukeDataBtn">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã</button>
                        <button class="owner-btn" id="viewBannedUsersBtn">–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö</button>
                        <button class="owner-btn" id="viewLocalPostsBtn">–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤</button>
                        <button class="owner-btn" id="viewIPBansBtn">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ IP-–±–∞–Ω–∞–º–∏</button>
                        <button class="owner-btn" id="cleanDuplicateBansBtn">–û—á–∏—Å—Ç–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç—ã –±–∞–Ω–æ–≤</button>
                        <button class="owner-btn" id="logoutOwnerBtn">–í—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞</button>
                    </div>
                    
                    <div class="categories">
                        <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                        <ul class="category-list">
                            <li class="category-item active" data-category="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</li>
                            <li class="category-item" data-category="programming">–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</li>
                            <li class="category-item" data-category="technology">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</li>
                            <li class="category-item" data-category="design">–î–∏–∑–∞–π–Ω</li>
                            <li class="category-item" data-category="education">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</li>
                            <li class="category-item" data-category="other">–î—Ä—É–≥–æ–µ</li>
                        </ul>
                    </div>
                    
                    <div class="community-rules">
                        <h3>–ü—Ä–∞–≤–∏–ª–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</h3>
                        <ul>
                            <li>–ë—É–¥—å—Ç–µ –≤–µ–∂–ª–∏–≤—ã –∏ —É–≤–∞–∂–∞–π—Ç–µ –¥—Ä—É–≥–∏—Ö</li>
                            <li>–ü—É–±–ª–∏–∫—É–π—Ç–µ —Ç–µ–º—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö</li>
                            <li>–ù–µ —Ä–∞–∑–º–µ—â–∞–π—Ç–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç</li>
                            <li>–°–ª–µ–¥—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞–º GitHub</li>
                        </ul>
                    </div>
                    
                    <div class="data-tools">
                        <h3>–†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏</h3>
                        <p>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –Ω–∞ –¥—Ä—É–≥–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–Ω–µ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.</p>
                        <div class="data-tools-buttons">
                            <button class="import-export-btn" id="exportDataBtn">–≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                            <button class="import-export-btn" id="importDataBtn">–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                            <button class="import-export-btn" id="becomeOwnerBtn">–†–µ–∂–∏–º –≤–ª–∞–¥–µ–ª—å—Ü–∞</button>
                        </div>
                    </div>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
                <div class="main-content active" id="home-page">
                    <div class="posts-container" id="postsContainer">
                        <!-- –ü–æ—Å—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="main-content" id="popular-page">
                    <div class="popular-posts" id="popularPostsContainer">
                        <!-- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –ø–æ—Å—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="main-content" id="communities-page">
                    <div class="communities-content">
                        <h2>–°–æ–æ–±—â–µ—Å—Ç–≤–∞ LocalOtvet <span class="live-badge">LIVE</span></h2>
                        <p>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞–º –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å–∞–º - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!</p>
                        
                        <div class="communities-grid" id="communitiesGrid">
                            <!-- –°–æ–æ–±—â–µ—Å—Ç–≤–∞ –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
                
                <div class="main-content" id="about-page">
                    <div class="about-content">
                        <div class="about-section">
                            <h2>–û –ø—Ä–æ–µ–∫—Ç–µ LocalOtvet</h2>
                            <p>LocalOtvet - —ç—Ç–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –æ–±–º–µ–Ω–∞ –∑–Ω–∞–Ω–∏—è–º–∏ –∏ –æ–ø—ã—Ç–æ–º, —Å–æ–∑–¥–∞–Ω–Ω–∞—è –¥–ª—è —Ä—É—Å—Å–∫–æ—è–∑—ã—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞. –ù–∞—à–∞ —Ü–µ–ª—å - —Å–æ–∑–¥–∞—Ç—å —É–¥–æ–±–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤, –≥–¥–µ –∫–∞–∂–¥—ã–π –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –ø–æ–º–æ—â—å –∏–ª–∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏.</p>
                        </div>
                        
                        <div class="about-section">
                            <h3>–ù–∞—à–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏</h3>
                            <ul class="feature-list">
                                <li>–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–π</li>
                                <li>–°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞ –ª—É—á—à–∏–µ –æ—Ç–≤–µ—Ç—ã</li>
                                <li>–ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ</li>
                                <li>–¢–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞</li>
                                <li>–≠–∫—Å–ø–æ—Ä—Ç –∏ –∏–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</li>
                                <li>–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</li>
                                <li>–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤</li>
                                <li>–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º</li>
                                <li>–°–∏—Å—Ç–µ–º–∞ –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</li>
                                <li>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</li>
                            </ul>
                        </div>
                        
                        <div class="about-section">
                            <h3>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</h3>
                            <p>LocalOtvet –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–µ–±-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö:</p>
                            <ul class="feature-list">
                                <li>HTML5, CSS3, JavaScript (ES6+)</li>
                                <li>Supabase –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</li>
                                <li>LocalStorage –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è</li>
                                <li>–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω</li>
                                <li>REST API –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</li>
                                <li>–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</li>
                                <li>–°–∏—Å—Ç–µ–º–∞ —á–µ—Ä–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞</li>
                            </ul>
                        </div>
                        
                        <div class="about-section">
                            <h3>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å –∫ –Ω–∞–º!</h3>
                            <p>LocalOtvet - —ç—Ç–æ –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ–µ–∫—Ç, –∏ –º—ã –≤—Å–µ–≥–¥–∞ —Ä–∞–¥—ã –Ω–æ–≤—ã–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç, –∑–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã, –æ—Ç–≤–µ—á–∞–π—Ç–µ –¥—Ä—É–≥–∏–º –∏ –ø–æ–º–æ–≥–∞–π—Ç–µ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –Ω–∞—à–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ!</p>
                            <p><strong>–í–º–µ—Å—Ç–µ –º—ã —Å–æ–∑–¥–∞–¥–∏–º –ª—É—á—à–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –¥–ª—è –æ–±–º–µ–Ω–∞ –∑–Ω–∞–Ω–∏—è–º–∏!</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="createPostModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–æ—Å—Ç</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="createPostForm">
                <div class="form-group">
                    <label for="postTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                    <input type="text" id="postTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="postContent">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</label>
                    <textarea id="postContent" class="form-control" rows="5" required></textarea>
                </div>
                <div class="form-group">
                    <label for="postCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                    <select id="postCategory" class="form-control" required>
                        <option value="programming">–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ</option>
                        <option value="technology">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</option>
                        <option value="design">–î–∏–∑–∞–π–Ω</option>
                        <option value="education">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</option>
                        <option value="other">–î—Ä—É–≥–æ–µ</option>
                    </select>
                </div>
                <button type="submit" class="submit-comment-btn">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
            </form>
        </div>
    </div>

    <div class="modal" id="importDataModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="importData">–í—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ (JSON):</label>
                <textarea id="importData" class="form-control" rows="5"></textarea>
            </div>
            <button class="submit-comment-btn" id="confirmImportBtn">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
    </div>

    <div class="modal" id="usernameModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∏–∫–Ω–µ–π–º–∞</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="usernameInput">–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –Ω–∏–∫–Ω–µ–π–º:</label>
                <input type="text" id="usernameInput" class="form-control" placeholder="–í–∞—à –Ω–æ–≤—ã–π –Ω–∏–∫–Ω–µ–π–º" maxlength="20">
                <small style="color: var(--gray-color); margin-top: 5px; display: block;">
                    –ú–∞–∫—Å–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤. –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏.
                </small>
            </div>
            <button class="submit-comment-btn" id="saveUsernameBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p id="deleteConfirmText">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="cancelDeleteBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="submit-comment-btn" style="background-color: var(--danger-color);" id="confirmDeleteBtn">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="ownerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–†–µ–∂–∏–º –≤–ª–∞–¥–µ–ª—å—Ü–∞</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="ownerPassword">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –≤–ª–∞–¥–µ–ª—å—Ü–∞:</label>
                <input type="password" id="ownerPassword" class="form-control" placeholder="–ü–∞—Ä–æ–ª—å">
                <small style="color: var(--gray-color); margin-top: 5px; display: block;">
                    –¢–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —ç—Ç–æ–º—É —Ä–µ–∂–∏–º—É.
                </small>
            </div>
            <button class="submit-comment-btn" id="verifyOwnerBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
        </div>
    </div>

    <div class="modal" id="nukeConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ö†Ô∏è –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø–æ—Å—Ç–æ–≤</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p style="color: var(--danger-color); font-weight: bold;">
                    –í–´ –£–í–ï–†–ï–ù–´, –ß–¢–û –•–û–¢–ò–¢–ï –£–î–ê–õ–ò–¢–¨ –í–°–ï –ü–û–°–¢–´?
                </p>
                <p>–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ —É–¥–∞–ª–∏—Ç –≤—Å–µ –ø–æ—Å—Ç—ã –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.</p>
                <p>–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–≤–µ–¥–∏—Ç–µ: <strong>–£–î–ê–õ–ò–¢–¨ –í–°–ï</strong></p>
                <input type="text" id="nukeConfirmation" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –£–î–ê–õ–ò–¢–¨ –í–°–ï">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="cancelNukeBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="submit-comment-btn" style="background-color: var(--danger-color);" id="confirmNukeBtn">–£–î–ê–õ–ò–¢–¨ –í–°–ï</button>
            </div>
        </div>
    </div>

    <div class="modal" id="banConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ë–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p id="banConfirmText">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–±–∞–Ω–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?</p>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="cancelBanBtn">–û—Ç–º–µ–Ω–∞</button>
                <button class="submit-comment-btn" style="background-color: var(--banned-color);" id="confirmBanBtn">–ó–∞–±–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="bannedUsersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–ó–∞–±–∞–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <div id="bannedUsersList">
                    <!-- –°–ø–∏—Å–æ–∫ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="closeBannedUsersBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <div class="modal" id="localPostsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p>–≠—Ç–∏ –ø–æ—Å—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ:</p>
                <div id="localPostsList">
                    <!-- –°–ø–∏—Å–æ–∫ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="closeLocalPostsBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
                <button class="submit-comment-btn" style="background-color: var(--danger-color);" id="clearLocalPostsBtn">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            </div>
        </div>
    </div>

    <!-- –ù–æ–≤–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IP-–±–∞–Ω–∞–º–∏ -->
    <div class="modal" id="ipBanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ IP-–±–∞–Ω–∞–º–∏</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label>–î–æ–±–∞–≤–∏—Ç—å IP –≤ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫:</label>
                <input type="text" id="ipToBan" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å">
                <small style="color: var(--gray-color);">–ù–∞–ø—Ä–∏–º–µ—Ä: 192.168.1.1</small>
            </div>
            <button class="submit-comment-btn" id="addIPBanBtn">–ó–∞–±–∞–Ω–∏—Ç—å IP</button>
            
            <div style="margin-top: 20px;">
                <h3>–ó–∞–±–∞–Ω–µ–Ω–Ω—ã–µ IP-–∞–¥—Ä–µ—Å–∞:</h3>
                <div id="bannedIPsList" style="max-height: 300px; overflow-y: auto; margin-top: 10px;">
                    <!-- –°–ø–∏—Å–æ–∫ IP –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="closeIPBanModalBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        // –ß–ï–†–ù–´–ô –°–ü–ò–°–û–ö - –¥–æ–±–∞–≤–ª—è–π—Ç–µ —Å—é–¥–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
        const BLACKLIST = [
            '–¥–æ–∫—Å', 'dokc', 'd–æ–∫—Å', '—Ä–∏–∞–Ω–æ—á–∫–∞', '—Ä–∏–∞–Ω–æ—á–∫–µ', '—Ä–∏–∞–Ω–æ—á–∫–∏', 
            '–µ–±–∞—Ç—å', '—Ö—É–π–Ω—è', '–±–ª—è—Ç—å', '666 –ª–∞–π–∫–æ–≤', '666–ª–∞–π–∫–æ–≤',
            '–≤–∑–ª–∞–º—ã–≤–∞—é—Ç', '—Ö–∞–∫', 'hack', '–≤–∑–ª–æ–º', 'hackers', '—Ö–∞–∫–µ—Ä—ã',
            // –î–æ–±–∞–≤–ª—è–π—Ç–µ –¥—Ä—É–≥–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞ –∑–¥–µ—Å—å
        ];

        // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID
        function generateUserId() {
            return 'user_' + Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –ø–æ—Å—Ç–∞–º–∏
        class LocalPostManager {
            constructor() {
                this.storageKey = 'localotvet_local_posts';
            }

            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å—Ç –ª–æ–∫–∞–ª—å–Ω–æ
            saveLocalPost(post) {
                const localPosts = this.getLocalPosts();
                localPosts.unshift(post);
                localStorage.setItem(this.storageKey, JSON.stringify(localPosts));
                return post;
            }

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã
            getLocalPosts() {
                const postsJson = localStorage.getItem(this.storageKey);
                return postsJson ? JSON.parse(postsJson) : [];
            }

            // –£–¥–∞–ª–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç
            deleteLocalPost(postId) {
                const localPosts = this.getLocalPosts();
                const updatedPosts = localPosts.filter(post => post.id !== postId);
                localStorage.setItem(this.storageKey, JSON.stringify(updatedPosts));
                return true;
            }

            // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã
            clearAllLocalPosts() {
                localStorage.removeItem(this.storageKey);
                return true;
            }

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã—Ö —Å–ª–æ–≤
            containsBlacklistedWords(text) {
                if (!text) return false;
                
                const lowerText = text.toLowerCase();
                return BLACKLIST.some(word => lowerText.includes(word.toLowerCase()));
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è IP-–±–∞–Ω–∞–º–∏
        class IPBanManager {
            constructor() {
                this.storageKey = 'localotvet_banned_ips';
            }

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã–µ IP
            getBannedIPs() {
                const ipsJson = localStorage.getItem(this.storageKey);
                return ipsJson ? JSON.parse(ipsJson) : [];
            }

            // –ó–∞–±–∞–Ω–∏—Ç—å IP
            banIP(ip) {
                const bannedIPs = this.getBannedIPs();
                if (!bannedIPs.includes(ip)) {
                    bannedIPs.push(ip);
                    localStorage.setItem(this.storageKey, JSON.stringify(bannedIPs));
                }
                return true;
            }

            // –†–∞–∑–±–∞–Ω–∏—Ç—å IP
            unbanIP(ip) {
                const bannedIPs = this.getBannedIPs();
                const updatedIPs = bannedIPs.filter(bannedIP => bannedIP !== ip);
                localStorage.setItem(this.storageKey, JSON.stringify(updatedIPs));
                return true;
            }

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–±–∞–Ω–µ–Ω –ª–∏ IP
            isIPBanned(ip) {
                const bannedIPs = this.getBannedIPs();
                return bannedIPs.includes(ip);
            }

            // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ IP-–±–∞–Ω—ã
            clearAllBans() {
                localStorage.removeItem(this.storageKey);
                return true;
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Å–æ–æ–±—â–µ—Å—Ç–≤
        class CommunityManager {
            constructor() {
                this.categories = {
                    'programming': { name: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ', icon: 'üíª', desc: '–û–±—Å—É–∂–¥–∞–µ–º —è–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è, —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ –∏ –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏' },
                    'technology': { name: '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏', icon: 'üîß', desc: '–ù–æ–≤–æ—Å—Ç–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π, –æ–±–∑–æ—Ä—ã –≥–∞–¥–∂–µ—Ç–æ–≤ –∏ –æ–±—Å—É–∂–¥–µ–Ω–∏–µ IT-–∏–Ω–¥—É—Å—Ç—Ä–∏–∏' },
                    'design': { name: '–î–∏–∑–∞–π–Ω', icon: 'üé®', desc: 'UI/UX –¥–∏–∑–∞–π–Ω, –≥—Ä–∞—Ñ–∏–∫–∞, –≤–µ–±-–¥–∏–∑–∞–π–Ω –∏ –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è' },
                    'education': { name: '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ', icon: 'üìö', desc: '–ö—É—Ä—Å—ã, —Å–∞–º–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç –≤ IT' },
                    'other': { name: '–î—Ä—É–≥–æ–µ', icon: 'ü§î', desc: '–í–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –ª—é–±—ã–µ —Ç–µ–º—ã' }
                };
            }

            // –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            calculateStats(posts) {
                const stats = {};
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                Object.keys(this.categories).forEach(category => {
                    stats[category] = {
                        postCount: 0,
                        authors: new Set(),
                        lastActivity: null
                    };
                });

                // –°–æ–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–∑ –ø–æ—Å—Ç–æ–≤
                posts.forEach(post => {
                    const category = post.category || 'other';
                    if (stats[category]) {
                        stats[category].postCount++;
                        stats[category].authors.add(post.authorId);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                        const postTime = new Date(post.timestamp);
                        if (!stats[category].lastActivity || postTime > stats[category].lastActivity) {
                            stats[category].lastActivity = postTime;
                        }
                    }
                });

                return stats;
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            formatLastActivity(date) {
                if (!date) return '–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏';
                
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                const diffDays = Math.floor(diffHours / 24);

                if (diffMins < 1) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
                if (diffMins < 60) return `${diffMins} –º–∏–Ω –Ω–∞–∑–∞–¥`;
                if (diffHours < 24) return `${diffHours} —á –Ω–∞–∑–∞–¥`;
                return `${diffDays} –¥–Ω –Ω–∞–∑–∞–¥`;
            }
        }

        // –ö–ª–∞—Å—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Supabase
        class SupabaseReddit {
            constructor() {
                // –í–ê–®–ò –î–ê–ù–ù–´–ï –ò–ó SUPABASE
                this.supabaseUrl = 'https://ncwejzjbgpjdzeiqolks.supabase.co';
                this.supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5jd2VqempiZ3BqZHplaXFvbGtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NTg0NjgsImV4cCI6MjA3NTMzNDQ2OH0.NaaEVVEyz444wMJcty4mjrsUs4OGHJ3a3Y5d3UTikhs';
                this.localPostManager = new LocalPostManager();
                this.ipBanManager = new IPBanManager();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∏–µ–Ω—Ç Supabase
                this.supabase = supabase.createClient(this.supabaseUrl, this.supabaseKey);
            }

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã
            async getPosts() {
                try {
                    const { data, error } = await this.supabase
                        .from('posts')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (error) {
                        console.error('Supabase error:', error);
                        throw error;
                    }
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ Supabase –≤ –Ω–∞—à —Ñ–æ—Ä–º–∞—Ç
                    return data.map(post => ({
                        id: post.id.toString(),
                        title: post.title,
                        content: post.content,
                        author: post.author,
                        authorId: post.author_id,
                        category: post.category,
                        timestamp: post.created_at,
                        votes: post.votes || 0,
                        comments: post.comments || [],
                        local: post.is_local || false,
                        blocked: post.is_blocked || false,
                        originalContent: post.original_content
                    }));
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤:', error);
                    return [];
                }
            }

            // –î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å—Ç
            async addPost(title, content, author = '–ê–Ω–æ–Ω–∏–º', authorId, category = 'other') {
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
                    const fullText = (title + ' ' + content).toLowerCase();
                    
                    if (this.localPostManager.containsBlacklistedWords(fullText)) {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
                        const localPost = {
                            id: 'local_' + Date.now().toString(),
                            title: title,
                            content: '[–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û] ' + content,
                            author: author,
                            authorId: authorId,
                            category: category,
                            timestamp: new Date().toISOString(),
                            votes: 0,
                            comments: [],
                            local: true,
                            blocked: true,
                            originalContent: content
                        };
                        
                        this.localPostManager.saveLocalPost(localPost);
                        throw new Error('BLOCKED_CONTENT: –ü–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ –∏–∑-–∑–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è');
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–∞–Ω–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
                    const isBanned = await this.isUserBanned(authorId);
                    if (isBanned) {
                        throw new Error('–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã');
                    }

                    // –°–æ–∑–¥–∞–µ–º –ø–æ—Å—Ç –≤ Supabase
                    const { data, error } = await this.supabase
                        .from('posts')
                        .insert([
                            {
                                title: title,
                                content: content,
                                author: author,
                                author_id: authorId,
                                category: category,
                                votes: 0,
                                comments: []
                            }
                        ])
                        .select();

                    if (error) throw error;

                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Ç–≤–µ—Ç –≤ –Ω–∞—à —Ñ–æ—Ä–º–∞—Ç
                    const newPost = data[0];
                    return {
                        id: newPost.id.toString(),
                        title: newPost.title,
                        content: newPost.content,
                        author: newPost.author,
                        authorId: newPost.author_id,
                        category: newPost.category,
                        timestamp: newPost.created_at,
                        votes: newPost.votes,
                        comments: newPost.comments
                    };

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞:', error);
                    throw error;
                }
            }

            // –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
            async vote(postId, isUpvote) {
                try {
                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π –ø–æ—Å—Ç
                    const { data: postData, error: getError } = await this.supabase
                        .from('posts')
                        .select('votes')
                        .eq('id', postId)
                        .single();

                    if (getError) throw getError;

                    let newVotes = postData.votes || 0;
                    if (isUpvote) {
                        newVotes += 1;
                    } else {
                        newVotes = Math.max(newVotes - 1, 0);
                    }

                    // –û–±–Ω–æ–≤–ª—è–µ–º –≥–æ–ª–æ—Å–∞
                    const { error: updateError } = await this.supabase
                        .from('posts')
                        .update({ votes: newVotes })
                        .eq('id', postId);

                    if (updateError) throw updateError;

                    return { votes: newVotes };

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', error);
                    throw error;
                }
            }

            // –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
            async addComment(postId, text, author = '–ê–Ω–æ–Ω–∏–º', authorId) {
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞ –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
                    if (this.localPostManager.containsBlacklistedWords(text)) {
                        throw new Error('BLOCKED_CONTENT: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–µ—â–µ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ');
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–Ω
                    const isBanned = await this.isUserBanned(authorId);
                    if (isBanned) {
                        throw new Error('–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏');
                    }

                    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                    const { data: postData, error: getError } = await this.supabase
                        .from('posts')
                        .select('comments')
                        .eq('id', postId)
                        .single();

                    if (getError) throw getError;

                    const comments = postData.comments || [];
                    const newComment = {
                        text: text,
                        author: author,
                        authorId: authorId,
                        timestamp: new Date().toISOString()
                    };

                    comments.push(newComment);

                    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                    const { error: updateError } = await this.supabase
                        .from('posts')
                        .update({ comments: comments })
                        .eq('id', postId);

                    if (updateError) throw updateError;

                    return { comments: comments };

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:', error);
                    throw error;
                }
            }

            // –£–¥–∞–ª–∏—Ç—å –ø–æ—Å—Ç
            async deletePost(postId) {
                try {
                    if (postId.startsWith('local_')) {
                        // –≠—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç
                        return this.localPostManager.deleteLocalPost(postId);
                    } else {
                        // –≠—Ç–æ –ø–æ—Å—Ç –∏–∑ Supabase
                        const { error } = await this.supabase
                            .from('posts')
                            .delete()
                            .eq('id', postId);

                        if (error) throw error;
                        return true;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞:', error);
                    throw error;
                }
            }

            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã (Supabase + –ª–æ–∫–∞–ª—å–Ω—ã–µ)
            async getAllPosts() {
                try {
                    const supabasePosts = await this.getPosts();
                    const localPosts = this.localPostManager.getLocalPosts();
                    
                    // –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
                    const allPosts = [...supabasePosts, ...localPosts].sort((a, b) => 
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );
                    
                    return allPosts;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤:', error);
                    return this.localPostManager.getLocalPosts();
                }
            }

            // –ë–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            async banUser(userId) {
                try {
                    const { error } = await this.supabase
                        .from('banned_users')
                        .insert([{ user_id: userId }]);

                    if (error) throw error;
                    return true;

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    throw error;
                }
            }

            // –†–∞–∑–±–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            async unbanUser(userId) {
                try {
                    const { error } = await this.supabase
                        .from('banned_users')
                        .delete()
                        .eq('user_id', userId);

                    if (error) throw error;
                    return true;

                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ä–∞–∑–±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    throw error;
                }
            }

            // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö
            async getBannedUsers() {
                try {
                    const { data, error } = await this.supabase
                        .from('banned_users')
                        .select('user_id');

                    if (error) throw error;
                    
                    return data.map(item => item.user_id);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö:', error);
                    return [];
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–±–∞–Ω–µ–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            async isUserBanned(userId) {
                try {
                    const { data, error } = await this.supabase
                        .from('banned_users')
                        .select('user_id')
                        .eq('user_id', userId)
                        .single();

                    // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–∞–Ω–µ–Ω
                    return !!data;
                } catch (error) {
                    // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ "No rows found" - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–±–∞–Ω–µ–Ω
                    return false;
                }
            }

            // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø–æ—Å—Ç—ã
            async nukeAllPosts() {
                try {
                    const { error } = await this.supabase
                        .from('posts')
                        .delete()
                        .neq('id', 0); // –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø–æ—Å—Ç—ã

                    if (error) throw error;

                    // –¢–∞–∫–∂–µ –æ—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã
                    this.localPostManager.clearAllLocalPosts();
                    
                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –ø–æ—Å—Ç–æ–≤:', error);
                    throw error;
                }
            }

            // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –±–∞–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            async nukeAllBans() {
                try {
                    const { error } = await this.supabase
                        .from('banned_users')
                        .delete()
                        .neq('user_id', 0); // –£–¥–∞–ª—è–µ–º –≤—Å–µ –±–∞–Ω—ã

                    if (error) throw error;
                    return true;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –±–∞–Ω–æ–≤:', error);
                    throw error;
                }
            }
        }

        // üîê –£–°–ò–õ–ï–ù–ù–´–ô –ö–õ–ê–°–° USERMANAGER –° –ó–ê–©–ò–¢–û–ô
        class SecureUserManager {
            constructor() {
                this.userId = localStorage.getItem('localotvet_userId');
                if (!this.userId) {
                    this.userId = generateUserId();
                    localStorage.setItem('localotvet_userId', this.userId);
                }
                
                this.currentUsername = localStorage.getItem('localotvet_username') || '–ê–Ω–æ–Ω–∏–º';
                this.isOwner = localStorage.getItem('localotvet_owner') === 'true';
                this.isBanned = false;
                
                // –ù–ï–°–ö–û–õ–¨–ö–û –£–†–û–í–ù–ï–ô –ó–ê–©–ò–¢–´:
                
                // 1. –•–µ—à –ø–∞—Ä–æ–ª—è (–æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞—â–∏—Ç–∞)
                this.ownerPasswordHash = "8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918";
                
                // 2. –°–æ–ª—å –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                this.passwordSalt = "localotvet_salt_2024_secure";
                
                // 3. –õ–∏–º–∏—Ç –ø–æ–ø—ã—Ç–æ–∫ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
                this.loginAttempts = parseInt(localStorage.getItem('owner_login_attempts')) || 0;
                this.lastAttemptTime = parseInt(localStorage.getItem('owner_last_attempt')) || 0;
                
                this.updateDisplay();
            }

            // –ü–æ–ª—É—á–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            getUsername() {
                return this.currentUsername;
            }

            // –ü–æ–ª—É—á–∏—Ç—å ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            getUserId() {
                return this.userId;
            }

            // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            setUsername(newUsername) {
                if (newUsername && newUsername.trim() !== '') {
                    this.currentUsername = newUsername.trim().substring(0, 20); // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã
                } else {
                    this.currentUsername = '–ê–Ω–æ–Ω–∏–º';
                }
                localStorage.setItem('localotvet_username', this.currentUsername);
                this.updateDisplay();
            }

            // –£–°–ò–õ–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ü–ê–†–û–õ–Ø
            async verifyOwner(password) {
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –ø–æ–ø—ã—Ç–æ–∫
                if (this.isLoginBlocked()) {
                    throw new Error('–ü—Ä–µ–≤—ã—à–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ 15 –º–∏–Ω—É—Ç.');
                }

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)
                if (!this.isPasswordStrong(password)) {
                    this.incrementAttempts();
                    return false;
                }

                try {
                    // –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å —Å —Å–æ–ª—å—é
                    const inputHash = await this.sha256(password + this.passwordSalt);
                    
                    if (inputHash === this.ownerPasswordHash) {
                        // –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
                        this.isOwner = true;
                        this.loginAttempts = 0;
                        localStorage.setItem('localotvet_owner', 'true');
                        localStorage.setItem('owner_login_attempts', '0');
                        this.updateDisplay();
                        return true;
                    } else {
                        // –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
                        this.incrementAttempts();
                        return false;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–æ–ª—è:', error);
                    this.incrementAttempts();
                    return false;
                }
            }

            // –ü–†–û–í–ï–†–ö–ê –ë–õ–û–ö–ò–†–û–í–ö–ò –í–•–û–î–ê
            isLoginBlocked() {
                const now = Date.now();
                const timeSinceLastAttempt = now - this.lastAttemptTime;
                
                // –ï—Å–ª–∏ –±–æ–ª—å—à–µ 5 –ø–æ–ø—ã—Ç–æ–∫ - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ 15 –º–∏–Ω—É—Ç
                if (this.loginAttempts >= 5 && timeSinceLastAttempt < 15 * 60 * 1000) {
                    return true;
                }
                
                // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–∞ –µ—Å–ª–∏ –ø—Ä–æ—à–ª–æ –±–æ–ª—å—à–µ 15 –º–∏–Ω—É—Ç
                if (timeSinceLastAttempt > 15 * 60 * 1000) {
                    this.loginAttempts = 0;
                    localStorage.setItem('owner_login_attempts', '0');
                }
                
                return false;
            }

            // –£–í–ï–õ–ò–ß–ï–ù–ò–ï –°–ß–ï–¢–ß–ò–ö–ê –ü–û–ü–´–¢–û–ö
            incrementAttempts() {
                this.loginAttempts++;
                this.lastAttemptTime = Date.now();
                localStorage.setItem('owner_login_attempts', this.loginAttempts.toString());
                localStorage.setItem('owner_last_attempt', this.lastAttemptTime.toString());
            }

            // –ü–†–û–í–ï–†–ö–ê –°–õ–û–ñ–ù–û–°–¢–ò –ü–ê–†–û–õ–Ø (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞)
            isPasswordStrong(password) {
                if (!password || password.length < 4) return false;
                
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
                // - –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞
                // - –ù–∞–ª–∏—á–∏–µ —Ä–∞–∑–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
                // –∏ —Ç.–¥.
                
                return true;
            }

            // –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø SHA-256 –•–ï–®–ê
            async sha256(message) {
                try {
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º —Å—Ç—Ä–æ–∫—É –≤ Uint8Array
                    const msgBuffer = new TextEncoder().encode(message);
                    
                    // –•–µ—à–∏—Ä—É–µ–º
                    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º ArrayBuffer –≤ –º–∞—Å—Å–∏–≤ –±–∞–π—Ç
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –±–∞–π—Ç—ã –≤ hex —Å—Ç—Ä–æ–∫—É
                    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                    return hashHex;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                    throw error;
                }
            }

            // –í—ã—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
            logoutOwner() {
                this.isOwner = false;
                localStorage.removeItem('localotvet_owner');
                this.updateDisplay();
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            async checkBanStatus(jsonBinApp) {
                try {
                    const bannedUsers = await jsonBinApp.getBannedUsers();
                    this.isBanned = bannedUsers.includes(this.userId);
                    this.updateDisplay();
                    return this.isBanned;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–Ω–∞:', error);
                    return false;
                }
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–æ–º –ø–æ—Å—Ç–∞
            isAuthorOfPost(post) {
                return post.authorId === this.userId;
            }

            updateDisplay() {
                const usernameDisplay = document.getElementById('usernameDisplay');
                const userAvatar = document.getElementById('userAvatar');
                const userIdDisplay = document.getElementById('userIdDisplay');
                const ownerTools = document.getElementById('ownerTools');
                const createPostBtn = document.getElementById('createPostBtn');
                const changeUsernameBtn = document.getElementById('changeUsernameBtn');
                
                if (usernameDisplay) {
                    usernameDisplay.textContent = this.currentUsername;
                    if (this.isOwner) {
                        usernameDisplay.innerHTML = this.currentUsername + '<span class="owner-badge">üëë –í–õ–ê–î–ï–õ–ï–¶</span>';
                    }
                    if (this.isBanned) {
                        usernameDisplay.classList.add('banned');
                        usernameDisplay.innerHTML = this.currentUsername + '<span class="banned-badge">–ó–ê–ë–ê–ù–ï–ù</span>';
                    } else {
                        usernameDisplay.classList.remove('banned');
                    }
                }
                
                if (userAvatar) {
                    if (this.isBanned) {
                        userAvatar.classList.add('banned');
                        userAvatar.style.backgroundColor = 'var(--banned-color)';
                    } else if (this.isOwner) {
                        userAvatar.style.backgroundColor = 'var(--owner-color)';
                        userAvatar.style.color = '#000';
                    } else {
                        userAvatar.style.backgroundColor = 'var(--primary-color)';
                        userAvatar.style.color = 'white';
                    }
                    
                    if (this.currentUsername === '–ê–Ω–æ–Ω–∏–º') {
                        userAvatar.textContent = 'A';
                    } else {
                        userAvatar.textContent = this.currentUsername.charAt(0).toUpperCase();
                    }
                }
                
                if (userIdDisplay) {
                    const shortId = this.userId.substring(0, 8) + '...';
                    userIdDisplay.textContent = `ID: ${shortId}`;
                    userIdDisplay.title = `–ü–æ–ª–Ω—ã–π ID: ${this.userId}`;
                }

                if (ownerTools) {
                    ownerTools.style.display = this.isOwner ? 'block' : 'none';
                }
                
                if (createPostBtn) {
                    createPostBtn.disabled = this.isBanned;
                    if (this.isBanned) {
                        createPostBtn.title = '–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã';
                    } else {
                        createPostBtn.title = '';
                    }
                }
                
                if (changeUsernameBtn) {
                    changeUsernameBtn.disabled = this.isBanned;
                    if (this.isBanned) {
                        changeUsernameBtn.title = '–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ –º–µ–Ω—è—Ç—å –Ω–∏–∫–Ω–µ–π–º';
                    } else {
                        changeUsernameBtn.title = '';
                    }
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è IP –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è IP:', error);
                return 'unknown';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ IP-–±–∞–Ω–∞
        async function checkIPBan() {
            try {
                const userIP = await getUserIP();
                const isBanned = jsonBinApp.ipBanManager.isIPBanned(userIP);
                
                if (isBanned) {
                    document.getElementById('banPage').style.display = 'flex';
                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('bannedIPDisplay').textContent = userIP;
                    return true;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ IP-–±–∞–Ω–∞:', error);
            }
            
            document.getElementById('banPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            return false;
        }

        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const postsContainer = document.getElementById('postsContainer');
            const popularPostsContainer = document.getElementById('popularPostsContainer');
            const createPostBtn = document.getElementById('createPostBtn');
            const createPostModal = document.getElementById('createPostModal');
            const createPostForm = document.getElementById('createPostForm');
            const exportDataBtn = document.getElementById('exportDataBtn');
            const importDataBtn = document.getElementById('importDataBtn');
            const importDataModal = document.getElementById('importDataModal');
            const confirmImportBtn = document.getElementById('confirmImportBtn');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            const syncStatus = document.getElementById('syncStatus');
            const navLinks = document.querySelectorAll('.nav-link');
            const mainContents = document.querySelectorAll('.main-content');
            const homeBtn = document.getElementById('homeBtn');
            const sidebar = document.getElementById('sidebar');
            const categoryItems = document.querySelectorAll('.category-item');
            const communitiesGrid = document.getElementById('communitiesGrid');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            const changeUsernameBtn = document.getElementById('changeUsernameBtn');
            const usernameModal = document.getElementById('usernameModal');
            const usernameInput = document.getElementById('usernameInput');
            const saveUsernameBtn = document.getElementById('saveUsernameBtn');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤
            const deleteConfirmModal = document.getElementById('deleteConfirmModal');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const deleteConfirmText = document.getElementById('deleteConfirmText');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è —Ä–µ–∂–∏–º–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
            const becomeOwnerBtn = document.getElementById('becomeOwnerBtn');
            const ownerModal = document.getElementById('ownerModal');
            const ownerPassword = document.getElementById('ownerPassword');
            const verifyOwnerBtn = document.getElementById('verifyOwnerBtn');
            const nukeDataBtn = document.getElementById('nukeDataBtn');
            const logoutOwnerBtn = document.getElementById('logoutOwnerBtn');
            const viewBannedUsersBtn = document.getElementById('viewBannedUsersBtn');
            const viewLocalPostsBtn = document.getElementById('viewLocalPostsBtn');
            const viewIPBansBtn = document.getElementById('viewIPBansBtn');
            const cleanDuplicateBansBtn = document.getElementById('cleanDuplicateBansBtn');
            const nukeConfirmModal = document.getElementById('nukeConfirmModal');
            const cancelNukeBtn = document.getElementById('cancelNukeBtn');
            const confirmNukeBtn = document.getElementById('confirmNukeBtn');
            const nukeConfirmation = document.getElementById('nukeConfirmation');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            const banConfirmModal = document.getElementById('banConfirmModal');
            const cancelBanBtn = document.getElementById('cancelBanBtn');
            const confirmBanBtn = document.getElementById('confirmBanBtn');
            const banConfirmText = document.getElementById('banConfirmText');
            const bannedUsersModal = document.getElementById('bannedUsersModal');
            const bannedUsersList = document.getElementById('bannedUsersList');
            const closeBannedUsersBtn = document.getElementById('closeBannedUsersBtn');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
            const localPostsModal = document.getElementById('localPostsModal');
            const localPostsList = document.getElementById('localPostsList');
            const closeLocalPostsBtn = document.getElementById('closeLocalPostsBtn');
            const clearLocalPostsBtn = document.getElementById('clearLocalPostsBtn');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è IP-–±–∞–Ω–æ–≤
            const ipBanModal = document.getElementById('ipBanModal');
            const ipToBan = document.getElementById('ipToBan');
            const addIPBanBtn = document.getElementById('addIPBanBtn');
            const bannedIPsList = document.getElementById('bannedIPsList');
            const closeIPBanModalBtn = document.getElementById('closeIPBanModalBtn');
            
            // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–ª–∞—Å—Å–æ–≤
            const jsonBinApp = new SupabaseReddit();
            const userManager = new SecureUserManager();
            const communityManager = new CommunityManager();
            
            // –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            let allPosts = [];
            let postToDelete = null;
            let currentCategory = 'all';
            let userToBan = null;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            initializeApp();
            
            async function initializeApp() {
                // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º IP-–±–∞–Ω
                const isBanned = await checkIPBan();
                if (isBanned) {
                    return; // –ù–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –µ—Å–ª–∏ IP –∑–∞–±–∞–Ω–µ–Ω
                }
                
                // –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–µ
                loadPosts();
                setupNavigation();
                setupUserEvents();
                setupDeleteEvents();
                setupOwnerEvents();
                setupCategories();
                setupBanEvents();
                setupLocalPostsEvents();
                setupIPBanEvents();
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            function setupCategories() {
                categoryItems.forEach(item => {
                    item.addEventListener('click', function() {
                        categoryItems.forEach(cat => cat.classList.remove('active'));
                        this.classList.add('active');
                        currentCategory = this.getAttribute('data-category');
                        filterPostsByCategory();
                    });
                });
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –±–∞–Ω–∞
            function setupBanEvents() {
                confirmBanBtn.addEventListener('click', async () => {
                    if (userToBan) {
                        try {
                            await banUser(userToBan);
                            banConfirmModal.style.display = 'none';
                            userToBan = null;
                            await loadPosts();
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –±–∞–Ω–∞:', error);
                            showSyncStatus('–û—à–∏–±–∫–∞ –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', false);
                        }
                    }
                });

                cancelBanBtn.addEventListener('click', () => {
                    banConfirmModal.style.display = 'none';
                    userToBan = null;
                });

                banConfirmModal.addEventListener('click', (e) => {
                    if (e.target === banConfirmModal) {
                        banConfirmModal.style.display = 'none';
                        userToBan = null;
                    }
                });

                viewBannedUsersBtn.addEventListener('click', async () => {
                    try {
                        const bannedUsers = await jsonBinApp.getBannedUsers();
                        displayBannedUsers(bannedUsers);
                        bannedUsersModal.style.display = 'flex';
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
                        showSyncStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö', false);
                    }
                });

                closeBannedUsersBtn.addEventListener('click', () => {
                    bannedUsersModal.style.display = 'none';
                });

                bannedUsersModal.addEventListener('click', (e) => {
                    if (e.target === bannedUsersModal) {
                        bannedUsersModal.style.display = 'none';
                    }
                });
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
            function setupLocalPostsEvents() {
                viewLocalPostsBtn.addEventListener('click', () => {
                    displayLocalPosts();
                    localPostsModal.style.display = 'flex';
                });

                closeLocalPostsBtn.addEventListener('click', () => {
                    localPostsModal.style.display = 'none';
                });

                clearLocalPostsBtn.addEventListener('click', async () => {
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã?')) {
                        jsonBinApp.localPostManager.clearAllLocalPosts();
                        showSyncStatus('–õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã –æ—á–∏—â–µ–Ω—ã', true);
                        localPostsModal.style.display = 'none';
                        await loadPosts();
                    }
                });

                localPostsModal.addEventListener('click', (e) => {
                    if (e.target === localPostsModal) {
                        localPostsModal.style.display = 'none';
                    }
                });
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è IP-–±–∞–Ω–æ–≤
            function setupIPBanEvents() {
                viewIPBansBtn.addEventListener('click', () => {
                    displayBannedIPs();
                    ipBanModal.style.display = 'flex';
                });

                addIPBanBtn.addEventListener('click', async () => {
                    const ip = ipToBan.value.trim();
                    if (!ip) {
                        alert('–í–≤–µ–¥–∏—Ç–µ IP-–∞–¥—Ä–µ—Å');
                        return;
                    }

                    // –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è IP
                    const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
                    if (!ipRegex.test(ip)) {
                        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π IP-–∞–¥—Ä–µ—Å');
                        return;
                    }

                    try {
                        await jsonBinApp.ipBanManager.banIP(ip);
                        ipToBan.value = '';
                        showSyncStatus('IP –∑–∞–±–∞–Ω–µ–Ω', true);
                        await displayBannedIPs();
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –±–∞–Ω–∞ IP:', error);
                        showSyncStatus('–û—à–∏–±–∫–∞ –±–∞–Ω–∞ IP', false);
                    }
                });

                closeIPBanModalBtn.addEventListener('click', () => {
                    ipBanModal.style.display = 'none';
                });

                ipBanModal.addEventListener('click', (e) => {
                    if (e.target === ipBanModal) {
                        ipBanModal.style.display = 'none';
                    }
                });

                cleanDuplicateBansBtn.addEventListener('click', async () => {
                    try {
                        await cleanDuplicateBans();
                        showSyncStatus('–î—É–±–ª–∏–∫–∞—Ç—ã –±–∞–Ω–æ–≤ –æ—á–∏—â–µ–Ω—ã', true);
                    } catch (error) {
                        console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤:', error);
                        showSyncStatus('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤', false);
                    }
                });
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            async function displayBannedUsers(bannedUsers) {
                bannedUsersList.innerHTML = '';
                
                if (bannedUsers.length === 0) {
                    bannedUsersList.innerHTML = '<p>–ù–µ—Ç –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>';
                    return;
                }
                
                const posts = await jsonBinApp.getPosts();
                const userMap = {};
                
                posts.forEach(post => {
                    if (!userMap[post.authorId]) {
                        userMap[post.authorId] = post.author || '–ê–Ω–æ–Ω–∏–º';
                    }
                    
                    if (post.comments) {
                        post.comments.forEach(comment => {
                            if (!userMap[comment.authorId]) {
                                userMap[comment.authorId] = comment.author || '–ê–Ω–æ–Ω–∏–º';
                            }
                        });
                    }
                });
                
                bannedUsers.forEach(userId => {
                    const userName = userMap[userId] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
                    const userElement = document.createElement('div');
                    userElement.className = 'user-item';
                    userElement.style.padding = '10px';
                    userElement.style.borderBottom = '1px solid #eee';
                    userElement.style.display = 'flex';
                    userElement.style.justifyContent = 'space-between';
                    userElement.style.alignItems = 'center';
                    
                    userElement.innerHTML = `
                        <div>
                            <strong>${userName}</strong>
                            <div style="font-size: 12px; color: #888;">ID: ${userId}</div>
                        </div>
                        <button class="unban-user-btn" data-user-id="${userId}" style="background-color: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            –†–∞–∑–±–∞–Ω–∏—Ç—å
                        </button>
                    `;
                    
                    bannedUsersList.appendChild(userElement);
                });
                
                document.querySelectorAll('.unban-user-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const userId = this.getAttribute('data-user-id');
                        try {
                            await jsonBinApp.unbanUser(userId);
                            showSyncStatus('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–∞–∑–±–∞–Ω–µ–Ω', true);
                            const updatedBannedUsers = await jsonBinApp.getBannedUsers();
                            displayBannedUsers(updatedBannedUsers);
                            await loadPosts();
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ —Ä–∞–∑–±–∞–Ω–∞:', error);
                            showSyncStatus('–û—à–∏–±–∫–∞ —Ä–∞–∑–±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', false);
                        }
                    });
                });
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
            function displayLocalPosts() {
                const localPosts = jsonBinApp.localPostManager.getLocalPosts();
                localPostsList.innerHTML = '';
                
                if (localPosts.length === 0) {
                    localPostsList.innerHTML = '<p>–ù–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤</p>';
                    return;
                }
                
                localPosts.forEach(post => {
                    const postElement = document.createElement('div');
                    postElement.className = 'post local-post';
                    postElement.style.marginBottom = '15px';
                    postElement.style.padding = '15px';
                    postElement.style.border = '1px solid #ddd';
                    postElement.style.borderRadius = '4px';
                    
                    postElement.innerHTML = `
                        <div class="post-header">
                            <div class="post-category">${post.category}</div>
                            <span class="local-badge">–õ–û–ö–ê–õ–¨–ù–´–ô</span>
                        </div>
                        <div class="post-content">
                            <h3 class="post-title">${escapeHtml(post.title)}</h3>
                            <div class="post-text">${escapeHtml(post.content)}</div>
                            <div class="security-alert" style="margin-top: 10px; padding: 8px; font-size: 12px;">
                                ‚ö†Ô∏è –≠—Ç–æ—Ç –ø–æ—Å—Ç –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∏–ª—å—Ç—Ä–æ–º
                            </div>
                            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                <strong>–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç:</strong> ${escapeHtml(post.originalContent || post.content.replace('[–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–û] ', ''))}
                            </div>
                        </div>
                        <div class="post-footer">
                            <div class="post-meta">
                                <small>${new Date(post.timestamp).toLocaleString('ru-RU')} | üë§ ${post.author || '–ê–Ω–æ–Ω–∏–º'}</small>
                            </div>
                            <div class="post-actions">
                                <button class="delete-post-btn" data-post-id="${post.id}">
                                    –£–¥–∞–ª–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    `;
                    
                    localPostsList.appendChild(postElement);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
                document.querySelectorAll('.delete-post-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const postId = this.getAttribute('data-post-id');
                        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç?')) {
                            jsonBinApp.localPostManager.deleteLocalPost(postId);
                            showSyncStatus('–õ–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Å—Ç —É–¥–∞–ª–µ–Ω', true);
                            displayLocalPosts(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                            loadPosts(); // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –ª–µ–Ω—Ç—É
                        }
                    });
                });
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö IP
            function displayBannedIPs() {
                const bannedIPs = jsonBinApp.ipBanManager.getBannedIPs();
                bannedIPsList.innerHTML = '';
                
                if (bannedIPs.length === 0) {
                    bannedIPsList.innerHTML = '<p>–ù–µ—Ç –∑–∞–±–∞–Ω–µ–Ω–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤</p>';
                    return;
                }
                
                bannedIPs.forEach(ip => {
                    const ipElement = document.createElement('div');
                    ipElement.className = 'banned-ip-item';
                    ipElement.style.padding = '10px';
                    ipElement.style.borderBottom = '1px solid #eee';
                    ipElement.style.display = 'flex';
                    ipElement.style.justifyContent = 'space-between';
                    ipElement.style.alignItems = 'center';
                    
                    ipElement.innerHTML = `
                        <div>
                            <strong>${ip}</strong>
                        </div>
                        <button class="unban-ip-btn" data-ip="${ip}" style="background-color: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            –†–∞–∑–±–∞–Ω–∏—Ç—å
                        </button>
                    `;
                    
                    bannedIPsList.appendChild(ipElement);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–∞–∑–±–∞–Ω–∞ IP
                document.querySelectorAll('.unban-ip-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const ip = this.getAttribute('data-ip');
                        try {
                            await jsonBinApp.ipBanManager.unbanIP(ip);
                            showSyncStatus('IP —Ä–∞–∑–±–∞–Ω–µ–Ω', true);
                            displayBannedIPs(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ —Ä–∞–∑–±–∞–Ω–∞ IP:', error);
                            showSyncStatus('–û—à–∏–±–∫–∞ —Ä–∞–∑–±–∞–Ω–∞ IP', false);
                        }
                    });
                });
            }
            
            // –û—á–∏—Å—Ç–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –±–∞–Ω–æ–≤
            async function cleanDuplicateBans() {
                try {
                    const bannedUsers = await jsonBinApp.getBannedUsers();
                    
                    // –£–±–∏—Ä–∞–µ–º –ø—É—Å—Ç—ã–µ ID –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã
                    const uniqueBannedUsers = [...new Set(bannedUsers.filter(userId => 
                        userId && userId.trim() !== '' && userId !== 'undefined'
                    ))];
                    
                    // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–∏–µ –±–∞–Ω—ã
                    await jsonBinApp.nukeAllBans();
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞—Ç–Ω–æ —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö
                    for (const userId of uniqueBannedUsers) {
                        await jsonBinApp.banUser(userId);
                    }
                    
                    showSyncStatus(`–û—á–∏—â–µ–Ω–æ ${bannedUsers.length - uniqueBannedUsers.length} –¥—É–±–ª–∏–∫–∞—Ç–æ–≤`, true);
                    return uniqueBannedUsers;
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –±–∞–Ω–æ–≤:', error);
                    throw error;
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Å–æ–æ–±—â–µ—Å—Ç–≤
            function updateCommunitiesStats() {
                const stats = communityManager.calculateStats(allPosts);
                
                if (!communitiesGrid) return;
                
                communitiesGrid.innerHTML = '';
                
                Object.entries(communityManager.categories).forEach(([categoryKey, categoryInfo]) => {
                    const categoryStats = stats[categoryKey] || { postCount: 0, authors: new Set(), lastActivity: null };
                    const authorCount = categoryStats.authors.size;
                    
                    const communityCard = document.createElement('div');
                    communityCard.className = 'community-card';
                    communityCard.setAttribute('data-category', categoryKey);
                    
                    communityCard.innerHTML = `
                        <div class="community-icon">${categoryInfo.icon}</div>
                        <h3>${categoryInfo.name}</h3>
                        <p>${categoryInfo.desc}</p>
                        <div class="community-stats">
                            <span>üìù ${categoryStats.postCount} –ø–æ—Å—Ç–æ–≤</span>
                            <span>üë• ${authorCount} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                        </div>
                        <div class="real-stats">
                            üì¢ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${communityManager.formatLastActivity(categoryStats.lastActivity)}
                        </div>
                    `;
                    
                    communitiesGrid.appendChild(communityCard);
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–æ–æ–±—â–µ—Å—Ç–≤
                attachCommunityHandlers();
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–æ–æ–±—â–µ—Å—Ç–≤
            function attachCommunityHandlers() {
                document.querySelectorAll('.community-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const category = this.getAttribute('data-category');
                        
                        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
                        showPage('home');
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                        navLinks.forEach(l => l.classList.remove('active'));
                        document.querySelector('.nav-link[data-page="home"]').classList.add('active');
                        
                        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ —Å–∞–π–¥–±–∞—Ä–µ
                        categoryItems.forEach(item => item.classList.remove('active'));
                        const categoryItem = document.querySelector(`.category-item[data-category="${category}"]`);
                        if (categoryItem) {
                            categoryItem.classList.add('active');
                            currentCategory = category;
                            filterPostsByCategory();
                        }
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                        showSyncStatus(`–ü–æ–∫–∞–∑–∞–Ω—ã –ø–æ—Å—Ç—ã –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: ${communityManager.categories[category].name}`, true);
                    });
                });
            }
            
            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–æ–≤ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            function filterPostsByCategory() {
                if (currentCategory === 'all') {
                    renderPosts(allPosts, postsContainer);
                } else {
                    const filteredPosts = allPosts.filter(post => post.category === currentCategory);
                    renderPosts(filteredPosts, postsContainer);
                }
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            function setupNavigation() {
                navLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const pageId = this.getAttribute('data-page');
                        showPage(pageId);
                        
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
                
                homeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showPage('home');
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    document.querySelector('.nav-link[data-page="home"]').classList.add('active');
                });
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            function setupUserEvents() {
                changeUsernameBtn.addEventListener('click', () => {
                    if (userManager.isBanned) {
                        showSyncStatus('–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ –º–µ–Ω—è—Ç—å –Ω–∏–∫–Ω–µ–π–º', false);
                        return;
                    }
                    usernameInput.value = userManager.currentUsername === '–ê–Ω–æ–Ω–∏–º' ? '' : userManager.currentUsername;
                    usernameModal.style.display = 'flex';
                });
                
                saveUsernameBtn.addEventListener('click', () => {
                    const newUsername = usernameInput.value.trim();
                    userManager.setUsername(newUsername);
                    usernameModal.style.display = 'none';
                    showSyncStatus('–ù–∏–∫–Ω–µ–π–º –∏–∑–º–µ–Ω–µ–Ω', true);
                });
                
                usernameModal.addEventListener('click', (e) => {
                    if (e.target === usernameModal) {
                        usernameModal.style.display = 'none';
                    }
                });
            }

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤
            function setupDeleteEvents() {
                confirmDeleteBtn.addEventListener('click', async () => {
                    if (postToDelete) {
                        try {
                            await deletePost(postToDelete);
                            deleteConfirmModal.style.display = 'none';
                            postToDelete = null;
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                            showSyncStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞', false);
                        }
                    }
                });

                cancelDeleteBtn.addEventListener('click', () => {
                    deleteConfirmModal.style.display = 'none';
                    postToDelete = null;
                });

                deleteConfirmModal.addEventListener('click', (e) => {
                    if (e.target === deleteConfirmModal) {
                        deleteConfirmModal.style.display = 'none';
                        postToDelete = null;
                    }
                });
            }

            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –¥–ª—è —Ä–µ–∂–∏–º–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞
            function setupOwnerEvents() {
                becomeOwnerBtn.addEventListener('click', () => {
                    ownerModal.style.display = 'flex';
                });

                verifyOwnerBtn.addEventListener('click', async () => {
                    const password = ownerPassword.value;
                    
                    if (!password) {
                        showSyncStatus('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å', false);
                        return;
                    }

                    try {
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                        verifyOwnerBtn.disabled = true;
                        verifyOwnerBtn.textContent = '–ü—Ä–æ–≤–µ—Ä–∫–∞...';
                        
                        if (await userManager.verifyOwner(password)) {
                            ownerModal.style.display = 'none';
                            ownerPassword.value = '';
                            showSyncStatus('–†–µ–∂–∏–º –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!', true);
                            loadPosts();
                        } else {
                            const attemptsLeft = 5 - userManager.loginAttempts;
                            if (attemptsLeft > 0) {
                                showSyncStatus(`–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å. –û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${attemptsLeft}`, false);
                            } else {
                                showSyncStatus('–î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –Ω–∞ 15 –º–∏–Ω—É—Ç', false);
                            }
                        }
                    } catch (error) {
                        showSyncStatus(`–û—à–∏–±–∫–∞: ${error.message}`, false);
                    } finally {
                        verifyOwnerBtn.disabled = false;
                        verifyOwnerBtn.textContent = '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å';
                    }
                });

                logoutOwnerBtn.addEventListener('click', () => {
                    userManager.logoutOwner();
                    showSyncStatus('–†–µ–∂–∏–º –≤–ª–∞–¥–µ–ª—å—Ü–∞ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', true);
                    loadPosts();
                });

                nukeDataBtn.addEventListener('click', () => {
                    nukeConfirmModal.style.display = 'flex';
                });

                confirmNukeBtn.addEventListener('click', async () => {
                    if (nukeConfirmation.value === '–£–î–ê–õ–ò–¢–¨ –í–°–ï') {
                        try {
                            await jsonBinApp.nukeAllPosts();
                            nukeConfirmModal.style.display = 'none';
                            nukeConfirmation.value = '';
                            showSyncStatus('–í—Å–µ –ø–æ—Å—Ç—ã —É–¥–∞–ª–µ–Ω—ã!', true);
                            await loadPosts();
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏:', error);
                            showSyncStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–æ–≤', false);
                        }
                    } else {
                        showSyncStatus('–í–≤–µ–¥–∏—Ç–µ —Ç–æ—á–Ω—É—é —Ñ—Ä–∞–∑—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è', false);
                    }
                });

                cancelNukeBtn.addEventListener('click', () => {
                    nukeConfirmModal.style.display = 'none';
                    nukeConfirmation.value = '';
                });

                ownerModal.addEventListener('click', (e) => {
                    if (e.target === ownerModal) {
                        ownerModal.style.display = 'none';
                    }
                });

                nukeConfirmModal.addEventListener('click', (e) => {
                    if (e.target === nukeConfirmModal) {
                        nukeConfirmModal.style.display = 'none';
                        nukeConfirmation.value = '';
                    }
                });
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É
            function showPage(pageId) {
                mainContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                document.getElementById(`${pageId}-page`).classList.add('active');
                
                if (pageId === 'home') {
                    sidebar.style.display = 'block';
                } else {
                    sidebar.style.display = 'none';
                }
                
                if (pageId === 'popular') {
                    renderPopularPosts();
                } else if (pageId === 'communities') {
                    updateCommunitiesStats();
                }
            }
            
            // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞
            createPostBtn.addEventListener('click', () => {
                if (userManager.isBanned) {
                    showSyncStatus('–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ—Å—Ç—ã', false);
                    return;
                }
                createPostModal.style.display = 'flex';
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫
            closeModalButtons.forEach(button => {
                button.addEventListener('click', () => {
                    createPostModal.style.display = 'none';
                    importDataModal.style.display = 'none';
                    usernameModal.style.display = 'none';
                    deleteConfirmModal.style.display = 'none';
                    ownerModal.style.display = 'none';
                    nukeConfirmModal.style.display = 'none';
                    banConfirmModal.style.display = 'none';
                    bannedUsersModal.style.display = 'none';
                    localPostsModal.style.display = 'none';
                    ipBanModal.style.display = 'none';
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
            window.addEventListener('click', (e) => {
                if (e.target === createPostModal) {
                    createPostModal.style.display = 'none';
                }
                if (e.target === importDataModal) {
                    importDataModal.style.display = 'none';
                }
                if (e.target === usernameModal) {
                    usernameModal.style.display = 'none';
                }
                if (e.target === deleteConfirmModal) {
                    deleteConfirmModal.style.display = 'none';
                    postToDelete = null;
                }
                if (e.target === ownerModal) {
                    ownerModal.style.display = 'none';
                }
                if (e.target === nukeConfirmModal) {
                    nukeConfirmModal.style.display = 'none';
                }
                if (e.target === banConfirmModal) {
                    banConfirmModal.style.display = 'none';
                    userToBan = null;
                }
                if (e.target === bannedUsersModal) {
                    bannedUsersModal.style.display = 'none';
                }
                if (e.target === localPostsModal) {
                    localPostsModal.style.display = 'none';
                }
                if (e.target === ipBanModal) {
                    ipBanModal.style.display = 'none';
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞
            createPostForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const title = document.getElementById('postTitle').value;
                const content = document.getElementById('postContent').value;
                const category = document.getElementById('postCategory').value;
                
                if (title && content) {
                    try {
                        await createPost(title, content, category);
                        createPostForm.reset();
                        createPostModal.style.display = 'none';
                    } catch (error) {
                        showSyncStatus(`–û—à–∏–±–∫–∞: ${error.message}`, false);
                    }
                } else {
                    showSyncStatus('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞', false);
                }
            });
            
            // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
            exportDataBtn.addEventListener('click', exportData);
            
            // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
            importDataBtn.addEventListener('click', () => {
                importDataModal.style.display = 'flex';
            });
            
            confirmImportBtn.addEventListener('click', importData);
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
            function showSyncStatus(message, isSuccess) {
                syncStatus.textContent = message;
                syncStatus.className = 'sync-status ' + (isSuccess ? 'sync-success' : 'sync-error');
                setTimeout(() => {
                    syncStatus.textContent = '';
                    syncStatus.className = 'sync-status';
                }, 5000);
            }
            
            // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤
            async function loadPosts() {
                try {
                    showSyncStatus('–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...', true);
                    allPosts = await jsonBinApp.getAllPosts();
                    
                    await userManager.checkBanStatus(jsonBinApp);
                    
                    // –û–ë–ù–û–í–õ–Ø–ï–ú –°–¢–ê–¢–ò–°–¢–ò–ö–£ –°–û–û–ë–©–ï–°–¢–í
                    updateCommunitiesStats();
                    
                    if (allPosts.length === 0) {
                        postsContainer.innerHTML = `
                            <div class="post">
                                <div class="post-content">
                                    <p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –ø–æ—Å—Ç!</p>
                                </div>
                            </div>
                        `;
                        showSyncStatus('–ü–æ—Å—Ç–æ–≤ –Ω–µ—Ç. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π!', true);
                        return;
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
                    const securityAlert = document.createElement('div');
                    securityAlert.className = 'security-alert';
                    securityAlert.innerHTML = `
                        <strong>üîí –ó–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω–∞:</strong> –ü–æ—Å—Ç—ã —Å –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ.
                    `;
                    
                    if (!document.querySelector('.security-alert')) {
                        postsContainer.prepend(securityAlert);
                    }
                    
                    filterPostsByCategory();
                    showSyncStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allPosts.length} –ø–æ—Å—Ç–æ–≤`, true);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–æ–≤:', error);
                    postsContainer.innerHTML = `
                        <div class="post">
                            <div class="post-content">
                                <p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}</p>
                                <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç—ã...</p>
                            </div>
                        </div>
                    `;
                    
                    try {
                        allPosts = jsonBinApp.localPostManager.getLocalPosts();
                        if (allPosts.length > 0) {
                            renderPosts(allPosts, postsContainer);
                            showSyncStatus(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allPosts.length} –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤`, true);
                        }
                    } catch (localError) {
                        showSyncStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤', false);
                    }
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
            function renderPopularPosts() {
                if (allPosts.length === 0) {
                    popularPostsContainer.innerHTML = `
                        <div class="post">
                            <div class="post-content">
                                <p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –ø–æ—Å—Ç–∞. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –ø–æ—Å—Ç!</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                const popularPosts = [...allPosts].sort((a, b) => (b.votes || 0) - (a.votes || 0));
                renderPosts(popularPosts, popularPostsContainer);
            }
            
            // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –ø–æ—Å—Ç–æ–≤
            async function renderPosts(posts, container) {
                container.innerHTML = '';
                
                if (posts.length === 0) {
                    container.innerHTML = `
                        <div class="post">
                            <div class="post-content">
                                <p>–ü–æ—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                const bannedUsers = await jsonBinApp.getBannedUsers();
                const sortedPosts = posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                sortedPosts.forEach((post) => {
                    const isAuthor = userManager.isAuthorOfPost(post);
                    const isOwner = userManager.isOwner;
                    const isPostAuthorBanned = bannedUsers.includes(post.authorId);
                    const isLocalPost = post.local;
                    
                    let categoryName = '–î—Ä—É–≥–æ–µ';
                    switch(post.category) {
                        case 'programming':
                            categoryName = '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ';
                            break;
                        case 'technology':
                            categoryName = '–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏';
                            break;
                        case 'design':
                            categoryName = '–î–∏–∑–∞–π–Ω';
                            break;
                        case 'education':
                            categoryName = '–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ';
                            break;
                    }
                    
                    const postElement = document.createElement('div');
                    postElement.className = 'post';
                    if (isPostAuthorBanned) {
                        postElement.classList.add('banned');
                    }
                    if (isLocalPost) {
                        postElement.classList.add('local-post');
                    }
                    
                    postElement.innerHTML = `
                        <div class="post-header">
                            <div class="post-category">${categoryName}</div>
                            ${isLocalPost ? '<span class="local-badge">–õ–û–ö–ê–õ–¨–ù–´–ô</span>' : ''}
                            <div class="post-votes">
                                <button class="vote-btn upvote" data-post-id="${post.id}" ${userManager.isBanned || isLocalPost ? 'disabled' : ''}>‚ñ≤</button>
                                <span class="vote-count">${post.votes || 0}</span>
                                <button class="vote-btn downvote" data-post-id="${post.id}" ${userManager.isBanned || isLocalPost ? 'disabled' : ''}>‚ñº</button>
                            </div>
                            <div>
                                <h3 class="post-title">${escapeHtml(post.title)}</h3>
                                <div class="post-text">${escapeHtml(post.content)}</div>
                                ${post.blocked ? '<div class="security-alert" style="margin-top: 10px; padding: 8px; font-size: 12px;">‚ö†Ô∏è –≠—Ç–æ—Ç –ø–æ—Å—Ç –±—ã–ª –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Ñ–∏–ª—å—Ç—Ä–æ–º</div>' : ''}
                            </div>
                        </div>
                        <div class="post-footer">
                            <div class="post-meta">
                                <small>${new Date(post.timestamp).toLocaleString('ru-RU')} | üë§ ${post.author || '–ê–Ω–æ–Ω–∏–º'} 
                                ${isPostAuthorBanned ? '<span class="banned-badge">–ó–ê–ë–ê–ù–ï–ù</span>' : ''}
                                ${isLocalPost ? '<span class="local-badge">–¢–û–õ–¨–ö–û –£ –í–ê–°</span>' : ''}
                                </small>
                            </div>
                            <div class="post-actions">
                                ${!isLocalPost ? `
                                    <button class="comments-btn" data-post-id="${post.id}" ${userManager.isBanned ? 'disabled' : ''}>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                                        </svg>
                                        –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (${post.comments ? post.comments.length : 0})
                                    </button>
                                ` : ''}
                                ${(isAuthor || isOwner) ? `
                                    <button class="delete-post-btn ${isOwner && !isAuthor ? 'owner-delete' : ''}" data-post-id="${post.id}" ${userManager.isBanned ? 'disabled' : ''}>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                        </svg>
                                        ${isOwner && !isAuthor ? '–£–¥–∞–ª–∏—Ç—å (–≤–ª–∞–¥–µ–ª–µ—Ü)' : '–£–¥–∞–ª–∏—Ç—å'}
                                    </button>
                                ` : ''}
                                ${isOwner && !isAuthor && !isPostAuthorBanned && !isLocalPost ? `
                                    <button class="ban-user-btn" data-user-id="${post.authorId}" data-username="${post.author || '–ê–Ω–æ–Ω–∏–º'}">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                        </svg>
                                        –ó–∞–±–∞–Ω–∏—Ç—å
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        ${!isLocalPost ? `
                        <div class="comments-section" id="comments-${post.id}">
                            ${post.comments && post.comments.length > 0 ? 
                                post.comments.map(comment => {
                                    const isCommentAuthorBanned = bannedUsers.includes(comment.authorId);
                                    return `
                                    <div class="comment">
                                        <div class="comment-header">
                                            ${new Date(comment.timestamp).toLocaleString('ru-RU')} | üë§ ${comment.author || '–ê–Ω–æ–Ω–∏–º'} ${isCommentAuthorBanned ? '<span class="banned-badge">–ó–ê–ë–ê–ù–ï–ù</span>' : ''}
                                            ${isOwner && !isCommentAuthorBanned && comment.authorId !== userManager.getUserId() ? `
                                                <button class="ban-user-btn" data-user-id="${comment.authorId}" data-username="${comment.author || '–ê–Ω–æ–Ω–∏–º'}" style="background: none; border: none; color: var(--banned-color); cursor: pointer; font-size: 12px;">
                                                    –ó–∞–±–∞–Ω–∏—Ç—å
                                                </button>
                                            ` : ''}
                                        </div>
                                        <div class="comment-text">${escapeHtml(comment.text)}</div>
                                    </div>
                                `}).join('') : 
                                '<p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>'
                            }
                            <div class="add-comment">
                                <textarea class="comment-textarea" placeholder="${userManager.isBanned ? '–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–í–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...'}" data-post-id="${post.id}" ${userManager.isBanned ? 'disabled' : ''}></textarea>
                                <button class="submit-comment-btn" data-post-id="${post.id}" ${userManager.isBanned ? 'disabled' : ''}>${userManager.isBanned ? '–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã' : '–û—Ç–ø—Ä–∞–≤–∏—Ç—å'}</button>
                            </div>
                        </div>
                        ` : ''}
                    `;
                    
                    container.appendChild(postElement);
                });
                
                attachEventHandlers();
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è HTML
            function escapeHtml(unsafe) {
                if (!unsafe) return '';
                return unsafe
                    .toString()
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
            
            // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            function attachEventHandlers() {
                document.querySelectorAll('.vote-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (userManager.isBanned) {
                            showSyncStatus('–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å', false);
                            return;
                        }
                        const postId = this.getAttribute('data-post-id');
                        const isUpvote = this.classList.contains('upvote');
                        votePost(postId, isUpvote);
                    });
                });
                
                document.querySelectorAll('.comments-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (userManager.isBanned) {
                            showSyncStatus('–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏', false);
                            return;
                        }
                        const postId = this.getAttribute('data-post-id');
                        const commentsSection = document.getElementById(`comments-${postId}`);
                        if (commentsSection) {
                            commentsSection.style.display = commentsSection.style.display === 'block' ? 'none' : 'block';
                        }
                    });
                });
                
                document.querySelectorAll('.submit-comment-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (userManager.isBanned) {
                            showSyncStatus('–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏', false);
                            return;
                        }
                        
                        const postId = this.getAttribute('data-post-id');
                        const textarea = document.querySelector(`.comment-textarea[data-post-id="${postId}"]`);
                        if (textarea) {
                            const commentText = textarea.value.trim();
                            if (commentText) {
                                addComment(postId, commentText);
                                textarea.value = '';
                            }
                        }
                    });
                });
                
                document.querySelectorAll('.delete-post-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (userManager.isBanned) {
                            showSyncStatus('–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã –∏ –Ω–µ –º–æ–∂–µ—Ç–µ —É–¥–∞–ª—è—Ç—å –ø–æ—Å—Ç—ã', false);
                            return;
                        }
                        
                        const postId = this.getAttribute('data-post-id');
                        const isOwner = userManager.isOwner;
                        const post = allPosts.find(p => p.id === postId);
                        const isAuthor = post && userManager.isAuthorOfPost(post);
                        
                        postToDelete = postId;
                        
                        if (isOwner && !isAuthor) {
                            deleteConfirmText.textContent = '–í—ã –¥–µ–π—Å—Ç–≤—É–µ—Ç–µ –∫–∞–∫ –≤–ª–∞–¥–µ–ª–µ—Ü. –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?';
                        } else {
                            deleteConfirmText.textContent = '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.';
                        }
                        
                        deleteConfirmModal.style.display = 'flex';
                    });
                });
                
                document.querySelectorAll('.ban-user-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const userId = this.getAttribute('data-user-id');
                        const username = this.getAttribute('data-username');
                        
                        userToBan = userId;
                        banConfirmText.textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–±–∞–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è "${username}"?`;
                        banConfirmModal.style.display = 'flex';
                    });
                });
            }
            
            // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞
            async function createPost(title, content, category) {
                try {
                    showSyncStatus('–°–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–∞...', true);
                    const author = userManager.getUsername();
                    const authorId = userManager.getUserId();
                    const post = await jsonBinApp.addPost(title, content, author, authorId, category);
                    await loadPosts(); // –≠—Ç–æ –æ–±–Ω–æ–≤–∏—Ç –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Å–æ–æ–±—â–µ—Å—Ç–≤
                    showSyncStatus('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω', true);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞:', error);
                    
                    if (error.message.includes('BLOCKED_CONTENT')) {
                        showSyncStatus('–ü–æ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (–æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∑–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞)', false);
                        await loadPosts(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–∞–∂–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
                    } else {
                        showSyncStatus(`–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å—Ç–∞: ${error.message}`, false);
                    }
                    throw error;
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞ –ø–æ—Å—Ç
            async function votePost(postId, isUpvote) {
                try {
                    await jsonBinApp.vote(postId, isUpvote);
                    await loadPosts();
                    showSyncStatus('–ì–æ–ª–æ—Å —É—á—Ç–µ–Ω', true);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:', error);
                    showSyncStatus('–û—à–∏–±–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è', false);
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
            async function addComment(postId, text) {
                try {
                    const author = userManager.getUsername();
                    const authorId = userManager.getUserId();
                    await jsonBinApp.addComment(postId, text, author, authorId);
                    await loadPosts();
                    showSyncStatus('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω', true);
                    
                    const commentsSection = document.getElementById(`comments-${postId}`);
                    if (commentsSection) {
                        commentsSection.style.display = 'block';
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:', error);
                    showSyncStatus(`–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è: ${error.message}`, false);
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞
            async function deletePost(postId) {
                try {
                    showSyncStatus('–£–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞...', true);
                    await jsonBinApp.deletePost(postId);
                    await loadPosts();
                    showSyncStatus('–ü–æ—Å—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω', true);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞:', error);
                    showSyncStatus('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞', false);
                    throw error;
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            async function banUser(userId) {
                try {
                    showSyncStatus('–ë–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', true);
                    await jsonBinApp.banUser(userId);
                    showSyncStatus('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–∞–Ω–µ–Ω', true);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
                    showSyncStatus('–û—à–∏–±–∫–∞ –±–∞–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', false);
                    throw error;
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
            async function exportData() {
                try {
                    const posts = await jsonBinApp.getPosts();
                    const dataStr = JSON.stringify(posts, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = 'localotvet_data.json';
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    showSyncStatus('–î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã', true);
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞:', error);
                    showSyncStatus('–û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', false);
                }
            }
            
            // –§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
            async function importData() {
                try {
                    const importDataText = document.getElementById('importData').value;
                    
                    if (!importDataText) {
                        alert('–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞');
                        return;
                    }
                    
                    const importedData = JSON.parse(importDataText);
                    
                    if (Array.isArray(importedData)) {
                        if (confirm('–≠—Ç–æ –∑–∞–º–µ–Ω–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ Supabase. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                            showSyncStatus('–ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö...', true);
                            // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ—Å—Ç—ã
                            await jsonBinApp.nukeAllPosts();
                            
                            // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–æ–≤—ã–µ –ø–æ—Å—Ç—ã
                            for (const post of importedData) {
                                try {
                                    await jsonBinApp.addPost(
                                        post.title,
                                        post.content,
                                        post.author,
                                        post.authorId,
                                        post.category
                                    );
                                } catch (error) {
                                    console.error('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –ø–æ—Å—Ç–∞:', error);
                                }
                            }
                            
                            await loadPosts();
                            importDataModal.style.display = 'none';
                            document.getElementById('importData').value = '';
                            showSyncStatus('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ Supabase', true);
                        }
                    } else {
                        alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö. –û–∂–∏–¥–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤.');
                    }
                } catch (e) {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ JSON: ' + e.message);
                    showSyncStatus('–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', false);
                }
            }
        });
    </script>
</body>
</html>

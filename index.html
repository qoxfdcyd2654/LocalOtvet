<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LocalOtvet</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #ff5700;
            --secondary-color: #f8f9fa;
            --dark-color: #1a1a1b;
            --light-color: #ffffff;
            --gray-color: #878a8c;
            --border-color: #ccc;
            --danger-color: #dc3545;
            --owner-color: #ffd700;
            --banned-color: #6c757d;
            --local-color: #4CAF50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--secondary-color);
            color: var(--dark-color);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        header {
            background-color: var(--light-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
            cursor: pointer;
        }
        
        .logo svg {
            margin-right: 10px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: var(--dark-color);
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        nav ul li a:hover, 
        nav ul li a.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Главный контейнер для всего контента */
        .app-container {
            display: flex;
            margin-top: 20px;
            gap: 20px;
            min-height: 80vh;
        }
        
        /* Боковая панель */
        .sidebar {
            width: 300px;
            background-color: var(--light-color);
            border-radius: 4px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .create-post-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .create-post-btn:hover {
            opacity: 0.9;
        }
        
        .create-post-btn:disabled {
            background-color: var(--banned-color);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .user-profile {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .user-avatar.banned {
            background-color: var(--banned-color);
        }

        .user-info {
            flex: 1;
        }

        .username {
            font-weight: bold;
            margin-bottom: 2px;
        }
        
        .username.banned {
            color: var(--banned-color);
            text-decoration: line-through;
        }

        .user-status {
            font-size: 12px;
            color: var(--gray-color);
        }
        
        .banned-badge {
            background-color: var(--banned-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }

        .change-username-btn {
            background: none;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        
        .change-username-btn:disabled {
            border-color: var(--banned-color);
            color: var(--banned-color);
            cursor: not-allowed;
        }

        .change-username-btn:hover:not(:disabled) {
            background-color: var(--primary-color);
            color: white;
        }
        
        .user-id-display {
            font-size: 10px;
            color: var(--gray-color);
            margin-top: 2px;
            font-family: monospace;
        }

        .owner-badge {
            background-color: var(--owner-color);
            color: #000;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .categories {
            margin-top: 20px;
        }
        
        .categories h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .category-list {
            list-style: none;
        }
        
        .category-item {
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-item:hover {
            background-color: #f0f0f0;
        }
        
        .category-item.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .community-rules {
            margin-top: 20px;
        }
        
        .community-rules h3 {
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .community-rules ul {
            padding-left: 20px;
            color: var(--gray-color);
            font-size: 14px;
        }
        
        /* Основная область контента */
        .main-content {
            flex: 1;
            display: none;
        }
        
        .main-content.active {
            display: block;
        }
        
        .posts-container {
            background-color: var(--light-color);
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .post {
            background-color: var(--light-color);
            border-radius: 4px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            overflow: hidden;
            border: 1px solid var(--border-color);
            position: relative;
        }
        
        .post.banned {
            opacity: 0.7;
            border-left: 4px solid var(--banned-color);
        }
        
        .post.local-post {
            border-left: 4px solid var(--local-color);
            background-color: #f9fff9;
        }
        
        .post-header {
            display: flex;
            align-items: center;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border-bottom: 1px solid var(--border-color);
        }
        
        .post-category {
            background-color: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 10px;
        }
        
        .post-votes {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 10px;
        }
        
        .vote-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--gray-color);
        }
        
        .vote-btn:hover:not(:disabled) {
            color: var(--primary-color);
        }
        
        .vote-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .vote-count {
            font-weight: bold;
            margin: 5px 0;
        }
        
        .post-content {
            padding: 15px;
        }
        
        .post-title {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        
        .post-text {
            margin-bottom: 15px;
            line-height: 1.5;
            color: var(--dark-color);
        }
        
        .post-footer {
            display: flex;
            justify-content: space-between;
            padding: 10px 15px;
            border-top: 1px solid var(--border-color);
            color: var(--gray-color);
            font-size: 14px;
        }
        
        .post-actions {
            display: flex;
            gap: 10px;
        }
        
        .comments-btn, .delete-post-btn, .ban-user-btn {
            background: none;
            border: none;
            color: var(--gray-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .comments-btn svg, .delete-post-btn svg, .ban-user-btn svg {
            margin-right: 5px;
        }
        
        .comments-btn:hover:not(:disabled) {
            color: var(--primary-color);
        }
        
        .comments-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .delete-post-btn {
            color: var(--danger-color);
        }

        .delete-post-btn.owner-delete {
            background-color: var(--owner-color);
            color: #000;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .delete-post-btn:hover:not(:disabled) {
            color: #bd2130;
        }
        
        .delete-post-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .ban-user-btn {
            color: var(--banned-color);
        }
        
        .ban-user-btn:hover:not(:disabled) {
            color: #495057;
        }
        
        .ban-user-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .comments-section {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            display: none;
        }
        
        .comment {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .comment:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .comment-header {
            font-size: 12px;
            color: var(--gray-color);
            margin-bottom: 5px;
        }
        
        .comment-text {
            line-height: 1.4;
        }
        
        .add-comment {
            margin-top: 15px;
        }
        
        .comment-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            resize: vertical;
            min-height: 80px;
            margin-bottom: 10px;
        }
        
        .comment-textarea:disabled {
            background-color: #f8f9fa;
            cursor: not-allowed;
        }
        
        .submit-comment-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .submit-comment-btn:disabled {
            background-color: var(--banned-color);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        /* Стили для раздела "Популярное" */
        .popular-posts {
            background-color: var(--light-color);
            border-radius: 4px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Стили для раздела "Сообщества" */
        .communities-content {
            background-color: var(--light-color);
            border-radius: 4px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .communities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .community-card {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            border: 1px solid var(--border-color);
            cursor: pointer;
        }
        
        .community-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .community-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
            color: white;
            font-size: 24px;
        }
        
        .community-stats {
            display: flex;
            margin-top: 15px;
            font-size: 14px;
            color: var(--gray-color);
        }
        
        .community-stats span {
            margin-right: 15px;
        }
        
        /* Стили для раздела "О проекте" */
        .about-content {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .about-section {
            margin-bottom: 30px;
        }
        
        .about-section h3 {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .feature-list {
            list-style: none;
            padding-left: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .feature-list li:before {
            content: "✓ ";
            color: var(--primary-color);
            font-weight: bold;
        }
        
        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: var(--light-color);
            padding: 20px;
            border-radius: 4px;
            width: 90%;
            max-width: 500px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
        }
        
        /* Инструменты данных */
        .data-tools {
            margin-top: 20px;
            padding: 15px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        
        .data-tools h3 {
            margin-bottom: 10px;
        }
        
        .data-tools-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .import-export-btn {
            padding: 8px 15px;
            background-color: #4f4f4f;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            flex: 1;
            min-width: 120px;
        }

        .owner-tools {
            margin-top: 15px;
            padding: 15px;
            background-color: #fff8e1;
            border-radius: 4px;
            border-left: 4px solid var(--owner-color);
        }
        
        .owner-tools h3 {
            color: #b8860b;
            margin-bottom: 10px;
        }
        
        .owner-btn {
            background-color: var(--owner-color);
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .sync-status {
            margin-top: 10px;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }
        
        .sync-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .sync-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        /* Бейджи для постов */
        .local-badge {
            background-color: var(--local-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .security-alert {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 15px;
            color: #856404;
        }
        
        /* Новые стили для сообществ */
        .real-stats {
            font-size: 12px;
            color: var(--gray-color);
            margin-top: 5px;
        }
        
        .live-badge {
            background-color: #4CAF50;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            margin-left: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* Стили для бан-страницы */
        .ban-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        
        .ban-message {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 15px;
            max-width: 500px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .ban-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        /* Адаптивность */
        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                margin-bottom: 20px;
            }
            
            .communities-grid {
                grid-template-columns: 1fr;
            }
            
            nav ul li {
                margin-left: 10px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            nav ul {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Бан-страница -->
    <div id="banPage" class="ban-container" style="display: none;">
        <div class="ban-message">
            <div class="ban-icon">🚫</div>
            <h2>Доступ ограничен</h2>
            <p>Ваш IP-адрес был заблокирован администратором.</p>
            <p>Если вы считаете, что это произошло по ошибке, свяжитесь с администрацией сайта.</p>
            <div style="margin-top: 20px; font-size: 12px; opacity: 0.7;">
                IP: <span id="bannedIPDisplay"></span>
            </div>
        </div>
    </div>

    <!-- Основное приложение -->
    <div id="mainApp">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo" id="homeBtn">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="#ff5700">
                            <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.74c.69 0 1.25.56 1.25 1.25a1.25 1.25 0 0 1-2.5 0c0-.69.56-1.25 1.25-1.25zm-4.41 3.08c0-2.42 1.72-4.44 4.42-4.44s4.42 2.02 4.42 4.44c0 1.13-.37 2.37-1.03 3.43-.65 1.06-1.5 1.95-2.47 2.62-1.55 1.07-3.22 1.64-4.92 1.64-1.7 0-3.37-.57-4.92-1.64-.97-.67-1.82-1.56-2.47-2.62-.66-1.06-1.03-2.3-1.03-3.43 0-2.42 1.72-4.44 4.42-4.44s4.42 2.02 4.42 4.44zm-7.6 0c0-1.5.65-2.74 1.98-3.72 1.33-.98 3.01-1.48 4.96-1.48 1.95 0 3.63.5 4.96 1.48 1.33.98 1.98 2.22 1.98 3.72 0 1.5-.65 2.74-1.98 3.72-1.33.98-3.01 1.48-4.96 1.48-1.95 0-3.63-.5-4.96-1.48-1.33-.98-1.98-2.22-1.98-3.72z"/>
                        </svg>
                        LocalOtvet
                    </div>
                    <nav>
                        <ul>
                            <li><a href="#" class="nav-link active" data-page="home">Главная</a></li>
                            <li><a href="#" class="nav-link" data-page="popular">Популярное</a></li>
                            <li><a href="#" class="nav-link" data-page="communities">Сообщества</a></li>
                            <li><a href="#" class="nav-link" data-page="about">О проекте</a></li>
                        </ul>
                    </nav>
                </div>
            </div>
        </header>

        <div class="container">
            <div class="app-container">
                <!-- Боковая панель (видна только на главной) -->
                <div class="sidebar" id="sidebar">
                    <div class="user-profile">
                        <div class="user-avatar" id="userAvatar">U</div>
                        <div class="user-info">
                            <div class="username" id="usernameDisplay">Аноним</div>
                            <div class="user-status">Участник</div>
                            <div class="user-id-display" id="userIdDisplay">ID: загрузка...</div>
                        </div>
                        <button class="change-username-btn" id="changeUsernameBtn">Изменить</button>
                    </div>

                    <button class="create-post-btn" id="createPostBtn">Создать пост</button>
                    
                    <div class="sync-status" id="syncStatus"></div>
                    
                    <div class="owner-tools" id="ownerTools" style="display: none;">
                        <h3>👑 Инструменты владельца</h3>
                        <button class="owner-btn" id="nukeDataBtn">Очистить все посты</button>
                        <button class="owner-btn" id="viewBannedUsersBtn">Просмотр забаненных</button>
                        <button class="owner-btn" id="viewLocalPostsBtn">Просмотр локальных постов</button>
                        <button class="owner-btn" id="viewIPBansBtn">Управление IP-банами</button>
                        <button class="owner-btn" id="cleanDuplicateBansBtn">Очистить дубликаты банов</button>
                        <button class="owner-btn" id="logoutOwnerBtn">Выйти из режима владельца</button>
                    </div>
                    
                    <div class="categories">
                        <h3>Категории</h3>
                        <ul class="category-list">
                            <li class="category-item active" data-category="all">Все категории</li>
                            <li class="category-item" data-category="programming">Программирование</li>
                            <li class="category-item" data-category="technology">Технологии</li>
                            <li class="category-item" data-category="design">Дизайн</li>
                            <li class="category-item" data-category="education">Образование</li>
                            <li class="category-item" data-category="other">Другое</li>
                        </ul>
                    </div>
                    
                    <div class="community-rules">
                        <h3>Правила сообщества</h3>
                        <ul>
                            <li>Будьте вежливы и уважайте других</li>
                            <li>Публикуйте темы в соответствующих разделах</li>
                            <li>Не размещайте коммерческий контент</li>
                            <li>Следуйте правилам GitHub</li>
                        </ul>
                    </div>
                    
                    <div class="data-tools">
                        <h3>Работа с данными</h3>
                        <p>Экспортируйте свои данные для переноса на другое устройство или импортируйте ранее сохраненные данные.</p>
                        <div class="data-tools-buttons">
                            <button class="import-export-btn" id="exportDataBtn">Экспорт данных</button>
                            <button class="import-export-btn" id="importDataBtn">Импорт данных</button>
                            <button class="import-export-btn" id="becomeOwnerBtn">Режим владельца</button>
                        </div>
                    </div>
                </div>

                <!-- Основной контент -->
                <div class="main-content active" id="home-page">
                    <div class="posts-container" id="postsContainer">
                        <!-- Посты будут загружаться здесь -->
                    </div>
                </div>
                
                <div class="main-content" id="popular-page">
                    <div class="popular-posts" id="popularPostsContainer">
                        <!-- Популярные посты будут загружаться здесь -->
                    </div>
                </div>
                
                <div class="main-content" id="communities-page">
                    <div class="communities-content">
                        <h2>Сообщества LocalOtvet <span class="live-badge">LIVE</span></h2>
                        <p>Присоединяйтесь к сообществам по интересам - статистика обновляется в реальном времени!</p>
                        
                        <div class="communities-grid" id="communitiesGrid">
                            <!-- Сообщества будут генерироваться динамически -->
                        </div>
                    </div>
                </div>
                
                <div class="main-content" id="about-page">
                    <div class="about-content">
                        <div class="about-section">
                            <h2>О проекте LocalOtvet</h2>
                            <p>LocalOtvet - это платформа для обмена знаниями и опытом, созданная для русскоязычного сообщества. Наша цель - создать удобное пространство для вопросов и ответов, где каждый может найти помощь или поделиться своими знаниями.</p>
                        </div>
                        
                        <div class="about-section">
                            <h3>Наши возможности</h3>
                            <ul class="feature-list">
                                <li>Создание постов и обсуждений</li>
                                <li>Система голосования за лучшие ответы</li>
                                <li>Комментирование и обсуждение</li>
                                <li>Тематические сообщества</li>
                                <li>Экспорт и импорт данных</li>
                                <li>Адаптивный дизайн для всех устройств</li>
                                <li>Безопасное удаление собственных постов</li>
                                <li>Режим администратора для управления контентом</li>
                                <li>Система бана пользователей</li>
                                <li>Автоматическая фильтрация запрещенного контента</li>
                            </ul>
                        </div>
                        
                        <div class="about-section">
                            <h3>Технологии</h3>
                            <p>LocalOtvet построен на современных веб-технологиях:</p>
                            <ul class="feature-list">
                                <li>HTML5, CSS3, JavaScript (ES6+)</li>
                                <li>Supabase для хранения данных</li>
                                <li>LocalStorage для локального хранения</li>
                                <li>Адаптивный дизайн</li>
                                <li>REST API для синхронизации</li>
                                <li>Уникальные ID пользователей для безопасности</li>
                                <li>Система черных списков для фильтрации контента</li>
                            </ul>
                        </div>
                        
                        <div class="about-section">
                            <h3>Присоединяйтесь к нам!</h3>
                            <p>LocalOtvet - это открытый проект, и мы всегда рады новым участников. Создавайте аккаунт, задавайте вопросы, отвечайте другим и помогайте развивать наше сообщество!</p>
                            <p><strong>Вместе мы создадим лучшее пространство для обмена знаниями!</strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальные окна -->
    <div class="modal" id="createPostModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Создать новый пост</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="createPostForm">
                <div class="form-group">
                    <label for="postTitle">Заголовок</label>
                    <input type="text" id="postTitle" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="postContent">Содержание</label>
                    <textarea id="postContent" class="form-control" rows="5" required></textarea>
                </div>
                <div class="form-group">
                    <label for="postCategory">Категория</label>
                    <select id="postCategory" class="form-control" required>
                        <option value="programming">Программирование</option>
                        <option value="technology">Технологии</option>
                        <option value="design">Дизайн</option>
                        <option value="education">Образование</option>
                        <option value="other">Другое</option>
                    </select>
                </div>
                <button type="submit" class="submit-comment-btn">Опубликовать</button>
            </form>
        </div>
    </div>

    <div class="modal" id="importDataModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Импорт данных</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="importData">Вставьте данные для импорта (JSON):</label>
                <textarea id="importData" class="form-control" rows="5"></textarea>
            </div>
            <button class="submit-comment-btn" id="confirmImportBtn">Импортировать</button>
        </div>
    </div>

    <div class="modal" id="usernameModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Изменение никнейма</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="usernameInput">Введите новый никнейм:</label>
                <input type="text" id="usernameInput" class="form-control" placeholder="Ваш новый никнейм" maxlength="20">
                <small style="color: var(--gray-color); margin-top: 5px; display: block;">
                    Максимум 20 символов. Оставьте пустым для анонимности.
                </small>
            </div>
            <button class="submit-comment-btn" id="saveUsernameBtn">Сохранить</button>
        </div>
    </div>

    <div class="modal" id="deleteConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Подтверждение удаления</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p id="deleteConfirmText">Вы уверены, что хотите удалить этот пост? Это действие нельзя отменить.</p>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="cancelDeleteBtn">Отмена</button>
                <button class="submit-comment-btn" style="background-color: var(--danger-color);" id="confirmDeleteBtn">Удалить</button>
            </div>
        </div>
    </div>

    <div class="modal" id="ownerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Режим владельца</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label for="ownerPassword">Введите пароль владельца:</label>
                <input type="password" id="ownerPassword" class="form-control" placeholder="Пароль">
                <small style="color: var(--gray-color); margin-top: 5px; display: block;">
                    Только владелец сайта имеет доступ к этому режиму.
                </small>
            </div>
            <button class="submit-comment-btn" id="verifyOwnerBtn">Подтвердить</button>
        </div>
    </div>

    <div class="modal" id="nukeConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>⚠️ Очистка всех постов</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p style="color: var(--danger-color); font-weight: bold;">
                    ВЫ УВЕРЕНЫ, ЧТО ХОТИТЕ УДАЛИТЬ ВСЕ ПОСТЫ?
                </p>
                <p>Это действие удалит все посты и комментарии без возможности восстановления.</p>
                <p>Для подтверждения введите: <strong>УДАЛИТЬ ВСЕ</strong></p>
                <input type="text" id="nukeConfirmation" class="form-control" placeholder="Введите УДАЛИТЬ ВСЕ">
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="cancelNukeBtn">Отмена</button>
                <button class="submit-comment-btn" style="background-color: var(--danger-color);" id="confirmNukeBtn">УДАЛИТЬ ВСЕ</button>
            </div>
        </div>
    </div>

    <div class="modal" id="banConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Бан пользователя</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p id="banConfirmText">Вы уверены, что хотите забанить этого пользователя?</p>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="cancelBanBtn">Отмена</button>
                <button class="submit-comment-btn" style="background-color: var(--banned-color);" id="confirmBanBtn">Забанить</button>
            </div>
        </div>
    </div>

    <div class="modal" id="bannedUsersModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Забаненные пользователи</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <div id="bannedUsersList">
                    <!-- Список забаненных пользователей будет здесь -->
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="closeBannedUsersBtn">Закрыть</button>
            </div>
        </div>
    </div>

    <div class="modal" id="localPostsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Локальные посты</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p>Эти посты содержат запрещенные слова и сохранены только локально:</p>
                <div id="localPostsList">
                    <!-- Список локальных постов будет здесь -->
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="closeLocalPostsBtn">Закрыть</button>
                <button class="submit-comment-btn" style="background-color: var(--danger-color);" id="clearLocalPostsBtn">Очистить все</button>
            </div>
        </div>
    </div>

    <!-- Новое модальное окно для управления IP-банами -->
    <div class="modal" id="ipBanModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Управление IP-банами</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <label>Добавить IP в черный список:</label>
                <input type="text" id="ipToBan" class="form-control" placeholder="Введите IP-адрес">
                <small style="color: var(--gray-color);">Например: 192.168.1.1</small>
            </div>
            <button class="submit-comment-btn" id="addIPBanBtn">Забанить IP</button>
            
            <div style="margin-top: 20px;">
                <h3>Забаненные IP-адреса:</h3>
                <div id="bannedIPsList" style="max-height: 300px; overflow-y: auto; margin-top: 10px;">
                    <!-- Список IP будет здесь -->
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="submit-comment-btn" style="background-color: var(--gray-color);" id="closeIPBanModalBtn">Закрыть</button>
            </div>
        </div>
    </div>

    <script>
        // ЧЕРНЫЙ СПИСОК - добавляйте сюда запрещенные слова
        const BLACKLIST = [
            'докс', 'dokc', 'dокс', 'рианочка', 'рианочке', 'рианочки', 
            'ебать', 'хуйня', 'блять', '666 лайков', '666лайков',
            'взламывают', 'хак', 'hack', 'взлом', 'hackers', 'хакеры',
            // Добавляйте другие запрещенные слова здесь
        ];

        // Генератор уникального ID
        function generateUserId() {
            return 'user_' + Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Класс для управления локальными постами
        class LocalPostManager {
            constructor() {
                this.storageKey = 'localotvet_local_posts';
            }

            // Сохранить пост локально
            saveLocalPost(post) {
                const localPosts = this.getLocalPosts();
                localPosts.unshift(post);
                localStorage.setItem(this.storageKey, JSON.stringify(localPosts));
                return post;
            }

            // Получить все локальные посты
            getLocalPosts() {
                const postsJson = localStorage.getItem(this.storageKey);
                return postsJson ? JSON.parse(postsJson) : [];
            }

            // Удалить локальный пост
            deleteLocalPost(postId) {
                const localPosts = this.getLocalPosts();
                const updatedPosts = localPosts.filter(post => post.id !== postId);
                localStorage.setItem(this.storageKey, JSON.stringify(updatedPosts));
                return true;
            }

            // Очистить все локальные посты
            clearAllLocalPosts() {
                localStorage.removeItem(this.storageKey);
                return true;
            }

            // Проверить текст на наличие запрещенных слов
            containsBlacklistedWords(text) {
                if (!text) return false;
                
                const lowerText = text.toLowerCase();
                return BLACKLIST.some(word => lowerText.includes(word.toLowerCase()));
            }
        }

        // Класс для управления IP-банами
        class IPBanManager {
            constructor() {
                this.storageKey = 'localotvet_banned_ips';
            }

            // Получить все забаненные IP
            getBannedIPs() {
                const ipsJson = localStorage.getItem(this.storageKey);
                return ipsJson ? JSON.parse(ipsJson) : [];
            }

            // Забанить IP
            banIP(ip) {
                const bannedIPs = this.getBannedIPs();
                if (!bannedIPs.includes(ip)) {
                    bannedIPs.push(ip);
                    localStorage.setItem(this.storageKey, JSON.stringify(bannedIPs));
                }
                return true;
            }

            // Разбанить IP
            unbanIP(ip) {
                const bannedIPs = this.getBannedIPs();
                const updatedIPs = bannedIPs.filter(bannedIP => bannedIP !== ip);
                localStorage.setItem(this.storageKey, JSON.stringify(updatedIPs));
                return true;
            }

            // Проверить, забанен ли IP
            isIPBanned(ip) {
                const bannedIPs = this.getBannedIPs();
                return bannedIPs.includes(ip);
            }

            // Очистить все IP-баны
            clearAllBans() {
                localStorage.removeItem(this.storageKey);
                return true;
            }
        }

        // Класс для управления статистикой сообществ
        class CommunityManager {
            constructor() {
                this.categories = {
                    'programming': { name: 'Программирование', icon: '💻', desc: 'Обсуждаем языки программирования, фреймворки и лучшие практики' },
                    'technology': { name: 'Технологии', icon: '🔧', desc: 'Новости технологий, обзоры гаджетов и обсуждение IT-индустрии' },
                    'design': { name: 'Дизайн', icon: '🎨', desc: 'UI/UX дизайн, графика, веб-дизайн и креативные решения' },
                    'education': { name: 'Образование', icon: '📚', desc: 'Курсы, самообразование и карьерный рост в IT' },
                    'other': { name: 'Другое', icon: '🤔', desc: 'Вопросы и ответы на любые темы' }
                };
            }

            // Сбор статистики по категориям
            calculateStats(posts) {
                const stats = {};
                
                // Инициализируем все категории
                Object.keys(this.categories).forEach(category => {
                    stats[category] = {
                        postCount: 0,
                        authors: new Set(),
                        lastActivity: null
                    };
                });

                // Собираем статистику из постов
                posts.forEach(post => {
                    const category = post.category || 'other';
                    if (stats[category]) {
                        stats[category].postCount++;
                        stats[category].authors.add(post.authorId);
                        
                        // Обновляем последнюю активность
                        const postTime = new Date(post.timestamp);
                        if (!stats[category].lastActivity || postTime > stats[category].lastActivity) {
                            stats[category].lastActivity = postTime;
                        }
                    }
                });

                return stats;
            }

            // Форматирование времени последней активности
            formatLastActivity(date) {
                if (!date) return 'нет активности';
                
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                const diffDays = Math.floor(diffHours / 24);

                if (diffMins < 1) return 'только что';
                if (diffMins < 60) return `${diffMins} мин назад`;
                if (diffHours < 24) return `${diffHours} ч назад`;
                return `${diffDays} дн назад`;
            }
        }

        // Класс для работы с Supabase
        class SupabaseReddit {
            constructor() {
                // ВАШИ ДАННЫЕ ИЗ SUPABASE
                this.supabaseUrl = 'https://ncwejzjbgpjdzeiqolks.supabase.co';
                this.supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5jd2VqempiZ3BqZHplaXFvbGtzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk3NTg0NjgsImV4cCI6MjA3NTMzNDQ2OH0.NaaEVVEyz444wMJcty4mjrsUs4OGHJ3a3Y5d3UTikhs';
                this.localPostManager = new LocalPostManager();
                this.ipBanManager = new IPBanManager();
                
                // Инициализируем клиент Supabase
                this.supabase = supabase.createClient(this.supabaseUrl, this.supabaseKey);
            }

            // Получить все посты
            async getPosts() {
                try {
                    const { data, error } = await this.supabase
                        .from('posts')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (error) {
                        console.error('Supabase error:', error);
                        throw error;
                    }
                    
                    // Преобразуем данные из Supabase в наш формат
                    return data.map(post => ({
                        id: post.id.toString(),
                        title: post.title,
                        content: post.content,
                        author: post.author,
                        authorId: post.author_id,
                        category: post.category,
                        timestamp: post.created_at,
                        votes: post.votes || 0,
                        comments: post.comments || [],
                        local: post.is_local || false,
                        blocked: post.is_blocked || false,
                        originalContent: post.original_content
                    }));
                } catch (error) {
                    console.error('Ошибка загрузки постов:', error);
                    return [];
                }
            }

            // Добавить пост
            async addPost(title, content, author = 'Аноним', authorId, category = 'other') {
                try {
                    // Проверяем на запрещенные слова
                    const fullText = (title + ' ' + content).toLowerCase();
                    
                    if (this.localPostManager.containsBlacklistedWords(fullText)) {
                        // Сохраняем локально
                        const localPost = {
                            id: 'local_' + Date.now().toString(),
                            title: title,
                            content: '[ЗАБЛОКИРОВАНО] ' + content,
                            author: author,
                            authorId: authorId,
                            category: category,
                            timestamp: new Date().toISOString(),
                            votes: 0,
                            comments: [],
                            local: true,
                            blocked: true,
                            originalContent: content
                        };
                        
                        this.localPostManager.saveLocalPost(localPost);
                        throw new Error('BLOCKED_CONTENT: Пост сохранен локально из-за запрещенного содержания');
                    }

                    // Проверяем, не забанен ли пользователь
                    const isBanned = await this.isUserBanned(authorId);
                    if (isBanned) {
                        throw new Error('Вы забанены и не можете создавать посты');
                    }

                    // Создаем пост в Supabase
                    const { data, error } = await this.supabase
                        .from('posts')
                        .insert([
                            {
                                title: title,
                                content: content,
                                author: author,
                                author_id: authorId,
                                category: category,
                                votes: 0,
                                comments: []
                            }
                        ])
                        .select();

                    if (error) throw error;

                    // Преобразуем ответ в наш формат
                    const newPost = data[0];
                    return {
                        id: newPost.id.toString(),
                        title: newPost.title,
                        content: newPost.content,
                        author: newPost.author,
                        authorId: newPost.author_id,
                        category: newPost.category,
                        timestamp: newPost.created_at,
                        votes: newPost.votes,
                        comments: newPost.comments
                    };

                } catch (error) {
                    console.error('Ошибка добавления поста:', error);
                    throw error;
                }
            }

            // Голосование
            async vote(postId, isUpvote) {
                try {
                    // Получаем текущий пост
                    const { data: postData, error: getError } = await this.supabase
                        .from('posts')
                        .select('votes')
                        .eq('id', postId)
                        .single();

                    if (getError) throw getError;

                    let newVotes = postData.votes || 0;
                    if (isUpvote) {
                        newVotes += 1;
                    } else {
                        newVotes = Math.max(newVotes - 1, 0);
                    }

                    // Обновляем голоса
                    const { error: updateError } = await this.supabase
                        .from('posts')
                        .update({ votes: newVotes })
                        .eq('id', postId);

                    if (updateError) throw updateError;

                    return { votes: newVotes };

                } catch (error) {
                    console.error('Ошибка голосования:', error);
                    throw error;
                }
            }

            // Добавить комментарий
            async addComment(postId, text, author = 'Аноним', authorId) {
                try {
                    // Проверяем комментарии на запрещенные слова
                    if (this.localPostManager.containsBlacklistedWords(text)) {
                        throw new Error('BLOCKED_CONTENT: Комментарий содержит запрещенное содержание');
                    }

                    // Проверяем бан
                    const isBanned = await this.isUserBanned(authorId);
                    if (isBanned) {
                        throw new Error('Вы забанены и не можете оставлять комментарии');
                    }

                    // Получаем текущие комментарии
                    const { data: postData, error: getError } = await this.supabase
                        .from('posts')
                        .select('comments')
                        .eq('id', postId)
                        .single();

                    if (getError) throw getError;

                    const comments = postData.comments || [];
                    const newComment = {
                        text: text,
                        author: author,
                        authorId: authorId,
                        timestamp: new Date().toISOString()
                    };

                    comments.push(newComment);

                    // Обновляем комментарии
                    const { error: updateError } = await this.supabase
                        .from('posts')
                        .update({ comments: comments })
                        .eq('id', postId);

                    if (updateError) throw updateError;

                    return { comments: comments };

                } catch (error) {
                    console.error('Ошибка добавления комментария:', error);
                    throw error;
                }
            }

            // Удалить пост
            async deletePost(postId) {
                try {
                    if (postId.startsWith('local_')) {
                        // Это локальный пост
                        return this.localPostManager.deleteLocalPost(postId);
                    } else {
                        // Это пост из Supabase
                        const { error } = await this.supabase
                            .from('posts')
                            .delete()
                            .eq('id', postId);

                        if (error) throw error;
                        return true;
                    }
                } catch (error) {
                    console.error('Ошибка удаления поста:', error);
                    throw error;
                }
            }

            // Получить все посты (Supabase + локальные)
            async getAllPosts() {
                try {
                    const supabasePosts = await this.getPosts();
                    const localPosts = this.localPostManager.getLocalPosts();
                    
                    // Объединяем и сортируем
                    const allPosts = [...supabasePosts, ...localPosts].sort((a, b) => 
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );
                    
                    return allPosts;
                } catch (error) {
                    console.error('Ошибка загрузки постов:', error);
                    return this.localPostManager.getLocalPosts();
                }
            }

            // Бан пользователя
            async banUser(userId) {
                try {
                    const { error } = await this.supabase
                        .from('banned_users')
                        .insert([{ user_id: userId }]);

                    if (error) throw error;
                    return true;

                } catch (error) {
                    console.error('Ошибка бана пользователя:', error);
                    throw error;
                }
            }

            // Разбан пользователя
            async unbanUser(userId) {
                try {
                    const { error } = await this.supabase
                        .from('banned_users')
                        .delete()
                        .eq('user_id', userId);

                    if (error) throw error;
                    return true;

                } catch (error) {
                    console.error('Ошибка разбана пользователя:', error);
                    throw error;
                }
            }

            // Получить список забаненных
            async getBannedUsers() {
                try {
                    const { data, error } = await this.supabase
                        .from('banned_users')
                        .select('user_id');

                    if (error) throw error;
                    
                    return data.map(item => item.user_id);
                } catch (error) {
                    console.error('Ошибка получения забаненных:', error);
                    return [];
                }
            }

            // Проверить, забанен ли пользователь
            async isUserBanned(userId) {
                try {
                    const { data, error } = await this.supabase
                        .from('banned_users')
                        .select('user_id')
                        .eq('user_id', userId)
                        .single();

                    // Если есть данные - пользователь забанен
                    return !!data;
                } catch (error) {
                    // Если ошибка "No rows found" - пользователь не забанен
                    return false;
                }
            }

            // Очистить все посты
            async nukeAllPosts() {
                try {
                    const { error } = await this.supabase
                        .from('posts')
                        .delete()
                        .neq('id', 0); // Удаляем все посты

                    if (error) throw error;

                    // Также очищаем локальные посты
                    this.localPostManager.clearAllLocalPosts();
                    
                    return true;
                } catch (error) {
                    console.error('Ошибка очистки постов:', error);
                    throw error;
                }
            }

            // Очистить все баны пользователей
            async nukeAllBans() {
                try {
                    const { error } = await this.supabase
                        .from('banned_users')
                        .delete()
                        .neq('user_id', 0); // Удаляем все баны

                    if (error) throw error;
                    return true;
                } catch (error) {
                    console.error('Ошибка очистки банов:', error);
                    throw error;
                }
            }
        }

        // 🔐 УСИЛЕННЫЙ КЛАСС USERMANAGER С ЗАЩИТОЙ
        class SecureUserManager {
            constructor() {
                this.userId = localStorage.getItem('localotvet_userId');
                if (!this.userId) {
                    this.userId = generateUserId();
                    localStorage.setItem('localotvet_userId', this.userId);
                }
                
                this.currentUsername = localStorage.getItem('localotvet_username') || 'Аноним';
                this.isOwner = localStorage.getItem('localotvet_owner') === 'true';
                this.isBanned = false;
                
                // НЕСКОЛЬКО УРОВНЕЙ ЗАЩИТЫ:
                
                // 1. Хеш пароля (основная защита)
                this.ownerPasswordHash = "8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918";
                
                // 2. Соль для дополнительной безопасности
                this.passwordSalt = "localotvet_salt_2024_secure";
                
                // 3. Лимит попыток ввода пароля
                this.loginAttempts = parseInt(localStorage.getItem('owner_login_attempts')) || 0;
                this.lastAttemptTime = parseInt(localStorage.getItem('owner_last_attempt')) || 0;
                
                this.updateDisplay();
            }

            // Получить имя пользователя
            getUsername() {
                return this.currentUsername;
            }

            // Получить ID пользователя
            getUserId() {
                return this.userId;
            }

            // Установить имя пользователя
            setUsername(newUsername) {
                if (newUsername && newUsername.trim() !== '') {
                    this.currentUsername = newUsername.trim().substring(0, 20); // Ограничение длины
                } else {
                    this.currentUsername = 'Аноним';
                }
                localStorage.setItem('localotvet_username', this.currentUsername);
                this.updateDisplay();
            }

            // УСИЛЕННАЯ ПРОВЕРКА ПАРОЛЯ
            async verifyOwner(password) {
                // Проверка лимита попыток
                if (this.isLoginBlocked()) {
                    throw new Error('Превышено количество попыток. Попробуйте через 15 минут.');
                }

                // Проверка сложности пароля (дополнительная защита)
                if (!this.isPasswordStrong(password)) {
                    this.incrementAttempts();
                    return false;
                }

                try {
                    // Хешируем пароль с солью
                    const inputHash = await this.sha256(password + this.passwordSalt);
                    
                    if (inputHash === this.ownerPasswordHash) {
                        // Успешный вход
                        this.isOwner = true;
                        this.loginAttempts = 0;
                        localStorage.setItem('localotvet_owner', 'true');
                        localStorage.setItem('owner_login_attempts', '0');
                        this.updateDisplay();
                        return true;
                    } else {
                        // Неверный пароль
                        this.incrementAttempts();
                        return false;
                    }
                } catch (error) {
                    console.error('Ошибка проверки пароля:', error);
                    this.incrementAttempts();
                    return false;
                }
            }

            // ПРОВЕРКА БЛОКИРОВКИ ВХОДА
            isLoginBlocked() {
                const now = Date.now();
                const timeSinceLastAttempt = now - this.lastAttemptTime;
                
                // Если больше 5 попыток - блокировка на 15 минут
                if (this.loginAttempts >= 5 && timeSinceLastAttempt < 15 * 60 * 1000) {
                    return true;
                }
                
                // Сброс счетчика если прошло больше 15 минут
                if (timeSinceLastAttempt > 15 * 60 * 1000) {
                    this.loginAttempts = 0;
                    localStorage.setItem('owner_login_attempts', '0');
                }
                
                return false;
            }

            // УВЕЛИЧЕНИЕ СЧЕТЧИКА ПОПЫТОК
            incrementAttempts() {
                this.loginAttempts++;
                this.lastAttemptTime = Date.now();
                localStorage.setItem('owner_login_attempts', this.loginAttempts.toString());
                localStorage.setItem('owner_last_attempt', this.lastAttemptTime.toString());
            }

            // ПРОВЕРКА СЛОЖНОСТИ ПАРОЛЯ (дополнительная защита)
            isPasswordStrong(password) {
                if (!password || password.length < 4) return false;
                
                // Можно добавить дополнительные проверки:
                // - Минимальная длина
                // - Наличие разных символов
                // и т.д.
                
                return true;
            }

            // ФУНКЦИЯ ДЛЯ СОЗДАНИЯ SHA-256 ХЕША
            async sha256(message) {
                try {
                    // Преобразуем строку в Uint8Array
                    const msgBuffer = new TextEncoder().encode(message);
                    
                    // Хешируем
                    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                    
                    // Преобразуем ArrayBuffer в массив байт
                    const hashArray = Array.from(new Uint8Array(hashBuffer));
                    
                    // Преобразуем байты в hex строку
                    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                    return hashHex;
                } catch (error) {
                    console.error('Ошибка хеширования:', error);
                    throw error;
                }
            }

            // Выход из режима владельца
            logoutOwner() {
                this.isOwner = false;
                localStorage.removeItem('localotvet_owner');
                this.updateDisplay();
            }

            // Проверка бана пользователя
            async checkBanStatus(jsonBinApp) {
                try {
                    const bannedUsers = await jsonBinApp.getBannedUsers();
                    this.isBanned = bannedUsers.includes(this.userId);
                    this.updateDisplay();
                    return this.isBanned;
                } catch (error) {
                    console.error('Ошибка проверки бана:', error);
                    return false;
                }
            }

            // Проверка, является ли пользователь автором поста
            isAuthorOfPost(post) {
                return post.authorId === this.userId;
            }

            updateDisplay() {
                const usernameDisplay = document.getElementById('usernameDisplay');
                const userAvatar = document.getElementById('userAvatar');
                const userIdDisplay = document.getElementById('userIdDisplay');
                const ownerTools = document.getElementById('ownerTools');
                const createPostBtn = document.getElementById('createPostBtn');
                const changeUsernameBtn = document.getElementById('changeUsernameBtn');
                
                if (usernameDisplay) {
                    usernameDisplay.textContent = this.currentUsername;
                    if (this.isOwner) {
                        usernameDisplay.innerHTML = this.currentUsername + '<span class="owner-badge">👑 ВЛАДЕЛЕЦ</span>';
                    }
                    if (this.isBanned) {
                        usernameDisplay.classList.add('banned');
                        usernameDisplay.innerHTML = this.currentUsername + '<span class="banned-badge">ЗАБАНЕН</span>';
                    } else {
                        usernameDisplay.classList.remove('banned');
                    }
                }
                
                if (userAvatar) {
                    if (this.isBanned) {
                        userAvatar.classList.add('banned');
                        userAvatar.style.backgroundColor = 'var(--banned-color)';
                    } else if (this.isOwner) {
                        userAvatar.style.backgroundColor = 'var(--owner-color)';
                        userAvatar.style.color = '#000';
                    } else {
                        userAvatar.style.backgroundColor = 'var(--primary-color)';
                        userAvatar.style.color = 'white';
                    }
                    
                    if (this.currentUsername === 'Аноним') {
                        userAvatar.textContent = 'A';
                    } else {
                        userAvatar.textContent = this.currentUsername.charAt(0).toUpperCase();
                    }
                }
                
                if (userIdDisplay) {
                    const shortId = this.userId.substring(0, 8) + '...';
                    userIdDisplay.textContent = `ID: ${shortId}`;
                    userIdDisplay.title = `Полный ID: ${this.userId}`;
                }

                if (ownerTools) {
                    ownerTools.style.display = this.isOwner ? 'block' : 'none';
                }
                
                if (createPostBtn) {
                    createPostBtn.disabled = this.isBanned;
                    if (this.isBanned) {
                        createPostBtn.title = 'Вы забанены и не можете создавать посты';
                    } else {
                        createPostBtn.title = '';
                    }
                }
                
                if (changeUsernameBtn) {
                    changeUsernameBtn.disabled = this.isBanned;
                    if (this.isBanned) {
                        changeUsernameBtn.title = 'Вы забанены и не можете менять никнейм';
                    } else {
                        changeUsernameBtn.title = '';
                    }
                }
            }
        }

        // Функция для получения IP пользователя
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Ошибка получения IP:', error);
                return 'unknown';
            }
        }

        // Функция проверки IP-бана
        async function checkIPBan() {
            try {
                const userIP = await getUserIP();
                const isBanned = jsonBinApp.ipBanManager.isIPBanned(userIP);
                
                if (isBanned) {
                    document.getElementById('banPage').style.display = 'flex';
                    document.getElementById('mainApp').style.display = 'none';
                    document.getElementById('bannedIPDisplay').textContent = userIP;
                    return true;
                }
            } catch (error) {
                console.error('Ошибка проверки IP-бана:', error);
            }
            
            document.getElementById('banPage').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            return false;
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Элементы DOM
            const postsContainer = document.getElementById('postsContainer');
            const popularPostsContainer = document.getElementById('popularPostsContainer');
            const createPostBtn = document.getElementById('createPostBtn');
            const createPostModal = document.getElementById('createPostModal');
            const createPostForm = document.getElementById('createPostForm');
            const exportDataBtn = document.getElementById('exportDataBtn');
            const importDataBtn = document.getElementById('importDataBtn');
            const importDataModal = document.getElementById('importDataModal');
            const confirmImportBtn = document.getElementById('confirmImportBtn');
            const closeModalButtons = document.querySelectorAll('.close-modal');
            const syncStatus = document.getElementById('syncStatus');
            const navLinks = document.querySelectorAll('.nav-link');
            const mainContents = document.querySelectorAll('.main-content');
            const homeBtn = document.getElementById('homeBtn');
            const sidebar = document.getElementById('sidebar');
            const categoryItems = document.querySelectorAll('.category-item');
            const communitiesGrid = document.getElementById('communitiesGrid');
            
            // Элементы для управления пользователем
            const changeUsernameBtn = document.getElementById('changeUsernameBtn');
            const usernameModal = document.getElementById('usernameModal');
            const usernameInput = document.getElementById('usernameInput');
            const saveUsernameBtn = document.getElementById('saveUsernameBtn');
            
            // Элементы для удаления постов
            const deleteConfirmModal = document.getElementById('deleteConfirmModal');
            const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
            const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
            const deleteConfirmText = document.getElementById('deleteConfirmText');
            
            // Элементы для режима владельца
            const becomeOwnerBtn = document.getElementById('becomeOwnerBtn');
            const ownerModal = document.getElementById('ownerModal');
            const ownerPassword = document.getElementById('ownerPassword');
            const verifyOwnerBtn = document.getElementById('verifyOwnerBtn');
            const nukeDataBtn = document.getElementById('nukeDataBtn');
            const logoutOwnerBtn = document.getElementById('logoutOwnerBtn');
            const viewBannedUsersBtn = document.getElementById('viewBannedUsersBtn');
            const viewLocalPostsBtn = document.getElementById('viewLocalPostsBtn');
            const viewIPBansBtn = document.getElementById('viewIPBansBtn');
            const cleanDuplicateBansBtn = document.getElementById('cleanDuplicateBansBtn');
            const nukeConfirmModal = document.getElementById('nukeConfirmModal');
            const cancelNukeBtn = document.getElementById('cancelNukeBtn');
            const confirmNukeBtn = document.getElementById('confirmNukeBtn');
            const nukeConfirmation = document.getElementById('nukeConfirmation');
            
            // Элементы для бана пользователей
            const banConfirmModal = document.getElementById('banConfirmModal');
            const cancelBanBtn = document.getElementById('cancelBanBtn');
            const confirmBanBtn = document.getElementById('confirmBanBtn');
            const banConfirmText = document.getElementById('banConfirmText');
            const bannedUsersModal = document.getElementById('bannedUsersModal');
            const bannedUsersList = document.getElementById('bannedUsersList');
            const closeBannedUsersBtn = document.getElementById('closeBannedUsersBtn');
            
            // Элементы для локальных постов
            const localPostsModal = document.getElementById('localPostsModal');
            const localPostsList = document.getElementById('localPostsList');
            const closeLocalPostsBtn = document.getElementById('closeLocalPostsBtn');
            const clearLocalPostsBtn = document.getElementById('clearLocalPostsBtn');
            
            // Элементы для IP-банов
            const ipBanModal = document.getElementById('ipBanModal');
            const ipToBan = document.getElementById('ipToBan');
            const addIPBanBtn = document.getElementById('addIPBanBtn');
            const bannedIPsList = document.getElementById('bannedIPsList');
            const closeIPBanModalBtn = document.getElementById('closeIPBanModalBtn');
            
            // Создаем экземпляры классов
            const jsonBinApp = new SupabaseReddit();
            const userManager = new SecureUserManager();
            const communityManager = new CommunityManager();
            
            // Текущее состояние
            let allPosts = [];
            let postToDelete = null;
            let currentCategory = 'all';
            let userToBan = null;
            
            // Инициализация
            initializeApp();
            
            async function initializeApp() {
                // Сначала проверяем IP-бан
                const isBanned = await checkIPBan();
                if (isBanned) {
                    return; // Не продолжаем инициализацию если IP забанен
                }
                
                // Затем загружаем остальное
                loadPosts();
                setupNavigation();
                setupUserEvents();
                setupDeleteEvents();
                setupOwnerEvents();
                setupCategories();
                setupBanEvents();
                setupLocalPostsEvents();
                setupIPBanEvents();
            }
            
            // Настройка категорий
            function setupCategories() {
                categoryItems.forEach(item => {
                    item.addEventListener('click', function() {
                        categoryItems.forEach(cat => cat.classList.remove('active'));
                        this.classList.add('active');
                        currentCategory = this.getAttribute('data-category');
                        filterPostsByCategory();
                    });
                });
            }
            
            // Настройка событий бана
            function setupBanEvents() {
                confirmBanBtn.addEventListener('click', async () => {
                    if (userToBan) {
                        try {
                            await banUser(userToBan);
                            banConfirmModal.style.display = 'none';
                            userToBan = null;
                            await loadPosts();
                        } catch (error) {
                            console.error('Ошибка бана:', error);
                            showSyncStatus('Ошибка бана пользователя', false);
                        }
                    }
                });

                cancelBanBtn.addEventListener('click', () => {
                    banConfirmModal.style.display = 'none';
                    userToBan = null;
                });

                banConfirmModal.addEventListener('click', (e) => {
                    if (e.target === banConfirmModal) {
                        banConfirmModal.style.display = 'none';
                        userToBan = null;
                    }
                });

                viewBannedUsersBtn.addEventListener('click', async () => {
                    try {
                        const bannedUsers = await jsonBinApp.getBannedUsers();
                        displayBannedUsers(bannedUsers);
                        bannedUsersModal.style.display = 'flex';
                    } catch (error) {
                        console.error('Ошибка загрузки забаненных пользователей:', error);
                        showSyncStatus('Ошибка загрузки списка забаненных', false);
                    }
                });

                closeBannedUsersBtn.addEventListener('click', () => {
                    bannedUsersModal.style.display = 'none';
                });

                bannedUsersModal.addEventListener('click', (e) => {
                    if (e.target === bannedUsersModal) {
                        bannedUsersModal.style.display = 'none';
                    }
                });
            }
            
            // Настройка событий для локальных постов
            function setupLocalPostsEvents() {
                viewLocalPostsBtn.addEventListener('click', () => {
                    displayLocalPosts();
                    localPostsModal.style.display = 'flex';
                });

                closeLocalPostsBtn.addEventListener('click', () => {
                    localPostsModal.style.display = 'none';
                });

                clearLocalPostsBtn.addEventListener('click', async () => {
                    if (confirm('Вы уверены, что хотите удалить все локальные посты?')) {
                        jsonBinApp.localPostManager.clearAllLocalPosts();
                        showSyncStatus('Локальные посты очищены', true);
                        localPostsModal.style.display = 'none';
                        await loadPosts();
                    }
                });

                localPostsModal.addEventListener('click', (e) => {
                    if (e.target === localPostsModal) {
                        localPostsModal.style.display = 'none';
                    }
                });
            }
            
            // Настройка событий для IP-банов
            function setupIPBanEvents() {
                viewIPBansBtn.addEventListener('click', () => {
                    displayBannedIPs();
                    ipBanModal.style.display = 'flex';
                });

                addIPBanBtn.addEventListener('click', async () => {
                    const ip = ipToBan.value.trim();
                    if (!ip) {
                        alert('Введите IP-адрес');
                        return;
                    }

                    // Простая валидация IP
                    const ipRegex = /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/;
                    if (!ipRegex.test(ip)) {
                        alert('Введите корректный IP-адрес');
                        return;
                    }

                    try {
                        await jsonBinApp.ipBanManager.banIP(ip);
                        ipToBan.value = '';
                        showSyncStatus('IP забанен', true);
                        await displayBannedIPs();
                    } catch (error) {
                        console.error('Ошибка бана IP:', error);
                        showSyncStatus('Ошибка бана IP', false);
                    }
                });

                closeIPBanModalBtn.addEventListener('click', () => {
                    ipBanModal.style.display = 'none';
                });

                ipBanModal.addEventListener('click', (e) => {
                    if (e.target === ipBanModal) {
                        ipBanModal.style.display = 'none';
                    }
                });

                cleanDuplicateBansBtn.addEventListener('click', async () => {
                    try {
                        await cleanDuplicateBans();
                        showSyncStatus('Дубликаты банов очищены', true);
                    } catch (error) {
                        console.error('Ошибка очистки дубликатов:', error);
                        showSyncStatus('Ошибка очистки дубликатов', false);
                    }
                });
            }
            
            // Отображение списка забаненных пользователей
            async function displayBannedUsers(bannedUsers) {
                bannedUsersList.innerHTML = '';
                
                if (bannedUsers.length === 0) {
                    bannedUsersList.innerHTML = '<p>Нет забаненных пользователей</p>';
                    return;
                }
                
                const posts = await jsonBinApp.getPosts();
                const userMap = {};
                
                posts.forEach(post => {
                    if (!userMap[post.authorId]) {
                        userMap[post.authorId] = post.author || 'Аноним';
                    }
                    
                    if (post.comments) {
                        post.comments.forEach(comment => {
                            if (!userMap[comment.authorId]) {
                                userMap[comment.authorId] = comment.author || 'Аноним';
                            }
                        });
                    }
                });
                
                bannedUsers.forEach(userId => {
                    const userName = userMap[userId] || 'Неизвестный пользователь';
                    const userElement = document.createElement('div');
                    userElement.className = 'user-item';
                    userElement.style.padding = '10px';
                    userElement.style.borderBottom = '1px solid #eee';
                    userElement.style.display = 'flex';
                    userElement.style.justifyContent = 'space-between';
                    userElement.style.alignItems = 'center';
                    
                    userElement.innerHTML = `
                        <div>
                            <strong>${userName}</strong>
                            <div style="font-size: 12px; color: #888;">ID: ${userId}</div>
                        </div>
                        <button class="unban-user-btn" data-user-id="${userId}" style="background-color: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            Разбанить
                        </button>
                    `;
                    
                    bannedUsersList.appendChild(userElement);
                });
                
                document.querySelectorAll('.unban-user-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const userId = this.getAttribute('data-user-id');
                        try {
                            await jsonBinApp.unbanUser(userId);
                            showSyncStatus('Пользователь разбанен', true);
                            const updatedBannedUsers = await jsonBinApp.getBannedUsers();
                            displayBannedUsers(updatedBannedUsers);
                            await loadPosts();
                        } catch (error) {
                            console.error('Ошибка разбана:', error);
                            showSyncStatus('Ошибка разбана пользователя', false);
                        }
                    });
                });
            }
            
            // Отображение локальных постов
            function displayLocalPosts() {
                const localPosts = jsonBinApp.localPostManager.getLocalPosts();
                localPostsList.innerHTML = '';
                
                if (localPosts.length === 0) {
                    localPostsList.innerHTML = '<p>Нет локальных постов</p>';
                    return;
                }
                
                localPosts.forEach(post => {
                    const postElement = document.createElement('div');
                    postElement.className = 'post local-post';
                    postElement.style.marginBottom = '15px';
                    postElement.style.padding = '15px';
                    postElement.style.border = '1px solid #ddd';
                    postElement.style.borderRadius = '4px';
                    
                    postElement.innerHTML = `
                        <div class="post-header">
                            <div class="post-category">${post.category}</div>
                            <span class="local-badge">ЛОКАЛЬНЫЙ</span>
                        </div>
                        <div class="post-content">
                            <h3 class="post-title">${escapeHtml(post.title)}</h3>
                            <div class="post-text">${escapeHtml(post.content)}</div>
                            <div class="security-alert" style="margin-top: 10px; padding: 8px; font-size: 12px;">
                                ⚠️ Этот пост был заблокирован автоматическим фильтром
                            </div>
                            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                <strong>Оригинальный текст:</strong> ${escapeHtml(post.originalContent || post.content.replace('[ЗАБЛОКИРОВАНО] ', ''))}
                            </div>
                        </div>
                        <div class="post-footer">
                            <div class="post-meta">
                                <small>${new Date(post.timestamp).toLocaleString('ru-RU')} | 👤 ${post.author || 'Аноним'}</small>
                            </div>
                            <div class="post-actions">
                                <button class="delete-post-btn" data-post-id="${post.id}">
                                    Удалить
                                </button>
                            </div>
                        </div>
                    `;
                    
                    localPostsList.appendChild(postElement);
                });
                
                // Добавляем обработчики для удаления локальных постов
                document.querySelectorAll('.delete-post-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const postId = this.getAttribute('data-post-id');
                        if (confirm('Удалить этот локальный пост?')) {
                            jsonBinApp.localPostManager.deleteLocalPost(postId);
                            showSyncStatus('Локальный пост удален', true);
                            displayLocalPosts(); // Обновляем список
                            loadPosts(); // Обновляем основную ленту
                        }
                    });
                });
            }
            
            // Отображение забаненных IP
            function displayBannedIPs() {
                const bannedIPs = jsonBinApp.ipBanManager.getBannedIPs();
                bannedIPsList.innerHTML = '';
                
                if (bannedIPs.length === 0) {
                    bannedIPsList.innerHTML = '<p>Нет забаненных IP-адресов</p>';
                    return;
                }
                
                bannedIPs.forEach(ip => {
                    const ipElement = document.createElement('div');
                    ipElement.className = 'banned-ip-item';
                    ipElement.style.padding = '10px';
                    ipElement.style.borderBottom = '1px solid #eee';
                    ipElement.style.display = 'flex';
                    ipElement.style.justifyContent = 'space-between';
                    ipElement.style.alignItems = 'center';
                    
                    ipElement.innerHTML = `
                        <div>
                            <strong>${ip}</strong>
                        </div>
                        <button class="unban-ip-btn" data-ip="${ip}" style="background-color: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            Разбанить
                        </button>
                    `;
                    
                    bannedIPsList.appendChild(ipElement);
                });
                
                // Обработчики для кнопок разбана IP
                document.querySelectorAll('.unban-ip-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const ip = this.getAttribute('data-ip');
                        try {
                            await jsonBinApp.ipBanManager.unbanIP(ip);
                            showSyncStatus('IP разбанен', true);
                            displayBannedIPs(); // Обновляем список
                        } catch (error) {
                            console.error('Ошибка разбана IP:', error);
                            showSyncStatus('Ошибка разбана IP', false);
                        }
                    });
                });
            }
            
            // Очистка дубликатов банов
            async function cleanDuplicateBans() {
                try {
                    const bannedUsers = await jsonBinApp.getBannedUsers();
                    
                    // Убираем пустые ID и дубликаты
                    const uniqueBannedUsers = [...new Set(bannedUsers.filter(userId => 
                        userId && userId.trim() !== '' && userId !== 'undefined'
                    ))];
                    
                    // Очищаем текущие баны
                    await jsonBinApp.nukeAllBans();
                    
                    // Добавляем обратно только уникальных
                    for (const userId of uniqueBannedUsers) {
                        await jsonBinApp.banUser(userId);
                    }
                    
                    showSyncStatus(`Очищено ${bannedUsers.length - uniqueBannedUsers.length} дубликатов`, true);
                    return uniqueBannedUsers;
                } catch (error) {
                    console.error('Ошибка очистки дубликатов банов:', error);
                    throw error;
                }
            }
            
            // Обновление статистики сообществ
            function updateCommunitiesStats() {
                const stats = communityManager.calculateStats(allPosts);
                
                if (!communitiesGrid) return;
                
                communitiesGrid.innerHTML = '';
                
                Object.entries(communityManager.categories).forEach(([categoryKey, categoryInfo]) => {
                    const categoryStats = stats[categoryKey] || { postCount: 0, authors: new Set(), lastActivity: null };
                    const authorCount = categoryStats.authors.size;
                    
                    const communityCard = document.createElement('div');
                    communityCard.className = 'community-card';
                    communityCard.setAttribute('data-category', categoryKey);
                    
                    communityCard.innerHTML = `
                        <div class="community-icon">${categoryInfo.icon}</div>
                        <h3>${categoryInfo.name}</h3>
                        <p>${categoryInfo.desc}</p>
                        <div class="community-stats">
                            <span>📝 ${categoryStats.postCount} постов</span>
                            <span>👥 ${authorCount} участников</span>
                        </div>
                        <div class="real-stats">
                            📢 Активность: ${communityManager.formatLastActivity(categoryStats.lastActivity)}
                        </div>
                    `;
                    
                    communitiesGrid.appendChild(communityCard);
                });
                
                // Добавляем обработчики событий для карточек сообществ
                attachCommunityHandlers();
            }
            
            // Обработчики для карточек сообществ
            function attachCommunityHandlers() {
                document.querySelectorAll('.community-card').forEach(card => {
                    card.addEventListener('click', function() {
                        const category = this.getAttribute('data-category');
                        
                        // Переключаемся на главную страницу
                        showPage('home');
                        
                        // Обновляем активные классы в навигации
                        navLinks.forEach(l => l.classList.remove('active'));
                        document.querySelector('.nav-link[data-page="home"]').classList.add('active');
                        
                        // Устанавливаем выбранную категорию в сайдбаре
                        categoryItems.forEach(item => item.classList.remove('active'));
                        const categoryItem = document.querySelector(`.category-item[data-category="${category}"]`);
                        if (categoryItem) {
                            categoryItem.classList.add('active');
                            currentCategory = category;
                            filterPostsByCategory();
                        }
                        
                        // Показываем сообщение о выбранной категории
                        showSyncStatus(`Показаны посты из категории: ${communityManager.categories[category].name}`, true);
                    });
                });
            }
            
            // Фильтрация постов по категории
            function filterPostsByCategory() {
                if (currentCategory === 'all') {
                    renderPosts(allPosts, postsContainer);
                } else {
                    const filteredPosts = allPosts.filter(post => post.category === currentCategory);
                    renderPosts(filteredPosts, postsContainer);
                }
            }
            
            // Настройка навигации
            function setupNavigation() {
                navLinks.forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const pageId = this.getAttribute('data-page');
                        showPage(pageId);
                        
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    });
                });
                
                homeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    showPage('home');
                    
                    navLinks.forEach(l => l.classList.remove('active'));
                    document.querySelector('.nav-link[data-page="home"]').classList.add('active');
                });
            }
            
            // Настройка событий пользователя
            function setupUserEvents() {
                changeUsernameBtn.addEventListener('click', () => {
                    if (userManager.isBanned) {
                        showSyncStatus('Вы забанены и не можете менять никнейм', false);
                        return;
                    }
                    usernameInput.value = userManager.currentUsername === 'Аноним' ? '' : userManager.currentUsername;
                    usernameModal.style.display = 'flex';
                });
                
                saveUsernameBtn.addEventListener('click', () => {
                    const newUsername = usernameInput.value.trim();
                    userManager.setUsername(newUsername);
                    usernameModal.style.display = 'none';
                    showSyncStatus('Никнейм изменен', true);
                });
                
                usernameModal.addEventListener('click', (e) => {
                    if (e.target === usernameModal) {
                        usernameModal.style.display = 'none';
                    }
                });
            }

            // Настройка событий для удаления постов
            function setupDeleteEvents() {
                confirmDeleteBtn.addEventListener('click', async () => {
                    if (postToDelete) {
                        try {
                            await deletePost(postToDelete);
                            deleteConfirmModal.style.display = 'none';
                            postToDelete = null;
                        } catch (error) {
                            console.error('Ошибка удаления:', error);
                            showSyncStatus('Ошибка удаления поста', false);
                        }
                    }
                });

                cancelDeleteBtn.addEventListener('click', () => {
                    deleteConfirmModal.style.display = 'none';
                    postToDelete = null;
                });

                deleteConfirmModal.addEventListener('click', (e) => {
                    if (e.target === deleteConfirmModal) {
                        deleteConfirmModal.style.display = 'none';
                        postToDelete = null;
                    }
                });
            }

            // Настройка событий для режима владельца
            function setupOwnerEvents() {
                becomeOwnerBtn.addEventListener('click', () => {
                    ownerModal.style.display = 'flex';
                });

                verifyOwnerBtn.addEventListener('click', async () => {
                    const password = ownerPassword.value;
                    
                    if (!password) {
                        showSyncStatus('Введите пароль', false);
                        return;
                    }

                    try {
                        // Показываем загрузку
                        verifyOwnerBtn.disabled = true;
                        verifyOwnerBtn.textContent = 'Проверка...';
                        
                        if (await userManager.verifyOwner(password)) {
                            ownerModal.style.display = 'none';
                            ownerPassword.value = '';
                            showSyncStatus('Режим владельца активирован!', true);
                            loadPosts();
                        } else {
                            const attemptsLeft = 5 - userManager.loginAttempts;
                            if (attemptsLeft > 0) {
                                showSyncStatus(`Неверный пароль. Осталось попыток: ${attemptsLeft}`, false);
                            } else {
                                showSyncStatus('Доступ заблокирован на 15 минут', false);
                            }
                        }
                    } catch (error) {
                        showSyncStatus(`Ошибка: ${error.message}`, false);
                    } finally {
                        verifyOwnerBtn.disabled = false;
                        verifyOwnerBtn.textContent = 'Подтвердить';
                    }
                });

                logoutOwnerBtn.addEventListener('click', () => {
                    userManager.logoutOwner();
                    showSyncStatus('Режим владельца деактивирован', true);
                    loadPosts();
                });

                nukeDataBtn.addEventListener('click', () => {
                    nukeConfirmModal.style.display = 'flex';
                });

                confirmNukeBtn.addEventListener('click', async () => {
                    if (nukeConfirmation.value === 'УДАЛИТЬ ВСЕ') {
                        try {
                            await jsonBinApp.nukeAllPosts();
                            nukeConfirmModal.style.display = 'none';
                            nukeConfirmation.value = '';
                            showSyncStatus('Все посты удалены!', true);
                            await loadPosts();
                        } catch (error) {
                            console.error('Ошибка очистки:', error);
                            showSyncStatus('Ошибка удаления постов', false);
                        }
                    } else {
                        showSyncStatus('Введите точную фразу для подтверждения', false);
                    }
                });

                cancelNukeBtn.addEventListener('click', () => {
                    nukeConfirmModal.style.display = 'none';
                    nukeConfirmation.value = '';
                });

                ownerModal.addEventListener('click', (e) => {
                    if (e.target === ownerModal) {
                        ownerModal.style.display = 'none';
                    }
                });

                nukeConfirmModal.addEventListener('click', (e) => {
                    if (e.target === nukeConfirmModal) {
                        nukeConfirmModal.style.display = 'none';
                        nukeConfirmation.value = '';
                    }
                });
            }
            
            // Показать страницу
            function showPage(pageId) {
                mainContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                document.getElementById(`${pageId}-page`).classList.add('active');
                
                if (pageId === 'home') {
                    sidebar.style.display = 'block';
                } else {
                    sidebar.style.display = 'none';
                }
                
                if (pageId === 'popular') {
                    renderPopularPosts();
                } else if (pageId === 'communities') {
                    updateCommunitiesStats();
                }
            }
            
            // Открытие модального окна создания поста
            createPostBtn.addEventListener('click', () => {
                if (userManager.isBanned) {
                    showSyncStatus('Вы забанены и не можете создавать посты', false);
                    return;
                }
                createPostModal.style.display = 'flex';
            });
            
            // Закрытие модальных окон при клике на крестик
            closeModalButtons.forEach(button => {
                button.addEventListener('click', () => {
                    createPostModal.style.display = 'none';
                    importDataModal.style.display = 'none';
                    usernameModal.style.display = 'none';
                    deleteConfirmModal.style.display = 'none';
                    ownerModal.style.display = 'none';
                    nukeConfirmModal.style.display = 'none';
                    banConfirmModal.style.display = 'none';
                    bannedUsersModal.style.display = 'none';
                    localPostsModal.style.display = 'none';
                    ipBanModal.style.display = 'none';
                });
            });
            
            // Закрытие модальных окон при клике вне их
            window.addEventListener('click', (e) => {
                if (e.target === createPostModal) {
                    createPostModal.style.display = 'none';
                }
                if (e.target === importDataModal) {
                    importDataModal.style.display = 'none';
                }
                if (e.target === usernameModal) {
                    usernameModal.style.display = 'none';
                }
                if (e.target === deleteConfirmModal) {
                    deleteConfirmModal.style.display = 'none';
                    postToDelete = null;
                }
                if (e.target === ownerModal) {
                    ownerModal.style.display = 'none';
                }
                if (e.target === nukeConfirmModal) {
                    nukeConfirmModal.style.display = 'none';
                }
                if (e.target === banConfirmModal) {
                    banConfirmModal.style.display = 'none';
                    userToBan = null;
                }
                if (e.target === bannedUsersModal) {
                    bannedUsersModal.style.display = 'none';
                }
                if (e.target === localPostsModal) {
                    localPostsModal.style.display = 'none';
                }
                if (e.target === ipBanModal) {
                    ipBanModal.style.display = 'none';
                }
            });
            
            // Обработка создания поста
            createPostForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const title = document.getElementById('postTitle').value;
                const content = document.getElementById('postContent').value;
                const category = document.getElementById('postCategory').value;
                
                if (title && content) {
                    try {
                        await createPost(title, content, category);
                        createPostForm.reset();
                        createPostModal.style.display = 'none';
                    } catch (error) {
                        showSyncStatus(`Ошибка: ${error.message}`, false);
                    }
                } else {
                    showSyncStatus('Заполните заголовок и содержание поста', false);
                }
            });
            
            // Экспорт данных
            exportDataBtn.addEventListener('click', exportData);
            
            // Импорт данных
            importDataBtn.addEventListener('click', () => {
                importDataModal.style.display = 'flex';
            });
            
            confirmImportBtn.addEventListener('click', importData);
            
            // Функция отображения статуса
            function showSyncStatus(message, isSuccess) {
                syncStatus.textContent = message;
                syncStatus.className = 'sync-status ' + (isSuccess ? 'sync-success' : 'sync-error');
                setTimeout(() => {
                    syncStatus.textContent = '';
                    syncStatus.className = 'sync-status';
                }, 5000);
            }
            
            // Функция загрузки постов
            async function loadPosts() {
                try {
                    showSyncStatus('Загрузка постов...', true);
                    allPosts = await jsonBinApp.getAllPosts();
                    
                    await userManager.checkBanStatus(jsonBinApp);
                    
                    // ОБНОВЛЯЕМ СТАТИСТИКУ СООБЩЕСТВ
                    updateCommunitiesStats();
                    
                    if (allPosts.length === 0) {
                        postsContainer.innerHTML = `
                            <div class="post">
                                <div class="post-content">
                                    <p>Пока нет ни одного поста. Будьте первым, кто создаст пост!</p>
                                </div>
                            </div>
                        `;
                        showSyncStatus('Постов нет. Создайте первый!', true);
                        return;
                    }
                    
                    // Добавляем предупреждение о безопасности
                    const securityAlert = document.createElement('div');
                    securityAlert.className = 'security-alert';
                    securityAlert.innerHTML = `
                        <strong>🔒 Защита активна:</strong> Посты с запрещенными словами автоматически блокируются и сохраняются локально.
                    `;
                    
                    if (!document.querySelector('.security-alert')) {
                        postsContainer.prepend(securityAlert);
                    }
                    
                    filterPostsByCategory();
                    showSyncStatus(`Загружено ${allPosts.length} постов`, true);
                    
                } catch (error) {
                    console.error('Ошибка загрузки постов:', error);
                    postsContainer.innerHTML = `
                        <div class="post">
                            <div class="post-content">
                                <p style="color: red;">Ошибка загрузки данных: ${error.message}</p>
                                <p>Загружаем локальные посты...</p>
                            </div>
                        </div>
                    `;
                    
                    try {
                        allPosts = jsonBinApp.localPostManager.getLocalPosts();
                        if (allPosts.length > 0) {
                            renderPosts(allPosts, postsContainer);
                            showSyncStatus(`Загружено ${allPosts.length} локальных постов`, true);
                        }
                    } catch (localError) {
                        showSyncStatus('Ошибка загрузки локальных постов', false);
                    }
                }
            }
            
            // Функция отрисовки популярных постов
            function renderPopularPosts() {
                if (allPosts.length === 0) {
                    popularPostsContainer.innerHTML = `
                        <div class="post">
                            <div class="post-content">
                                <p>Пока нет ни одного поста. Будьте первым, кто создаст пост!</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                const popularPosts = [...allPosts].sort((a, b) => (b.votes || 0) - (a.votes || 0));
                renderPosts(popularPosts, popularPostsContainer);
            }
            
            // Функция отрисовки постов
            async function renderPosts(posts, container) {
                container.innerHTML = '';
                
                if (posts.length === 0) {
                    container.innerHTML = `
                        <div class="post">
                            <div class="post-content">
                                <p>Постов не найдено.</p>
                            </div>
                        </div>
                    `;
                    return;
                }
                
                const bannedUsers = await jsonBinApp.getBannedUsers();
                const sortedPosts = posts.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                sortedPosts.forEach((post) => {
                    const isAuthor = userManager.isAuthorOfPost(post);
                    const isOwner = userManager.isOwner;
                    const isPostAuthorBanned = bannedUsers.includes(post.authorId);
                    const isLocalPost = post.local;
                    
                    let categoryName = 'Другое';
                    switch(post.category) {
                        case 'programming':
                            categoryName = 'Программирование';
                            break;
                        case 'technology':
                            categoryName = 'Технологии';
                            break;
                        case 'design':
                            categoryName = 'Дизайн';
                            break;
                        case 'education':
                            categoryName = 'Образование';
                            break;
                    }
                    
                    const postElement = document.createElement('div');
                    postElement.className = 'post';
                    if (isPostAuthorBanned) {
                        postElement.classList.add('banned');
                    }
                    if (isLocalPost) {
                        postElement.classList.add('local-post');
                    }
                    
                    postElement.innerHTML = `
                        <div class="post-header">
                            <div class="post-category">${categoryName}</div>
                            ${isLocalPost ? '<span class="local-badge">ЛОКАЛЬНЫЙ</span>' : ''}
                            <div class="post-votes">
                                <button class="vote-btn upvote" data-post-id="${post.id}" ${userManager.isBanned || isLocalPost ? 'disabled' : ''}>▲</button>
                                <span class="vote-count">${post.votes || 0}</span>
                                <button class="vote-btn downvote" data-post-id="${post.id}" ${userManager.isBanned || isLocalPost ? 'disabled' : ''}>▼</button>
                            </div>
                            <div>
                                <h3 class="post-title">${escapeHtml(post.title)}</h3>
                                <div class="post-text">${escapeHtml(post.content)}</div>
                                ${post.blocked ? '<div class="security-alert" style="margin-top: 10px; padding: 8px; font-size: 12px;">⚠️ Этот пост был заблокирован автоматическим фильтром</div>' : ''}
                            </div>
                        </div>
                        <div class="post-footer">
                            <div class="post-meta">
                                <small>${new Date(post.timestamp).toLocaleString('ru-RU')} | 👤 ${post.author || 'Аноним'} 
                                ${isPostAuthorBanned ? '<span class="banned-badge">ЗАБАНЕН</span>' : ''}
                                ${isLocalPost ? '<span class="local-badge">ТОЛЬКО У ВАС</span>' : ''}
                                </small>
                            </div>
                            <div class="post-actions">
                                ${!isLocalPost ? `
                                    <button class="comments-btn" data-post-id="${post.id}" ${userManager.isBanned ? 'disabled' : ''}>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
                                        </svg>
                                        Комментарии (${post.comments ? post.comments.length : 0})
                                    </button>
                                ` : ''}
                                ${(isAuthor || isOwner) ? `
                                    <button class="delete-post-btn ${isOwner && !isAuthor ? 'owner-delete' : ''}" data-post-id="${post.id}" ${userManager.isBanned ? 'disabled' : ''}>
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                        </svg>
                                        ${isOwner && !isAuthor ? 'Удалить (владелец)' : 'Удалить'}
                                    </button>
                                ` : ''}
                                ${isOwner && !isAuthor && !isPostAuthorBanned && !isLocalPost ? `
                                    <button class="ban-user-btn" data-user-id="${post.authorId}" data-username="${post.author || 'Аноним'}">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                                        </svg>
                                        Забанить
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                        ${!isLocalPost ? `
                        <div class="comments-section" id="comments-${post.id}">
                            ${post.comments && post.comments.length > 0 ? 
                                post.comments.map(comment => {
                                    const isCommentAuthorBanned = bannedUsers.includes(comment.authorId);
                                    return `
                                    <div class="comment">
                                        <div class="comment-header">
                                            ${new Date(comment.timestamp).toLocaleString('ru-RU')} | 👤 ${comment.author || 'Аноним'} ${isCommentAuthorBanned ? '<span class="banned-badge">ЗАБАНЕН</span>' : ''}
                                            ${isOwner && !isCommentAuthorBanned && comment.authorId !== userManager.getUserId() ? `
                                                <button class="ban-user-btn" data-user-id="${comment.authorId}" data-username="${comment.author || 'Аноним'}" style="background: none; border: none; color: var(--banned-color); cursor: pointer; font-size: 12px;">
                                                    Забанить
                                                </button>
                                            ` : ''}
                                        </div>
                                        <div class="comment-text">${escapeHtml(comment.text)}</div>
                                    </div>
                                `}).join('') : 
                                '<p>Пока нет комментариев. Будьте первым!</p>'
                            }
                            <div class="add-comment">
                                <textarea class="comment-textarea" placeholder="${userManager.isBanned ? 'Вы забанены и не можете комментировать' : 'Ваш комментарий...'}" data-post-id="${post.id}" ${userManager.isBanned ? 'disabled' : ''}></textarea>
                                <button class="submit-comment-btn" data-post-id="${post.id}" ${userManager.isBanned ? 'disabled' : ''}>${userManager.isBanned ? 'Вы забанены' : 'Отправить'}</button>
                            </div>
                        </div>
                        ` : ''}
                    `;
                    
                    container.appendChild(postElement);
                });
                
                attachEventHandlers();
            }
            
            // Функция для экранирования HTML
            function escapeHtml(unsafe) {
                if (!unsafe) return '';
                return unsafe
                    .toString()
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
            
            // Функция присоединения обработчиков событий
            function attachEventHandlers() {
                document.querySelectorAll('.vote-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (userManager.isBanned) {
                            showSyncStatus('Вы забанены и не можете голосовать', false);
                            return;
                        }
                        const postId = this.getAttribute('data-post-id');
                        const isUpvote = this.classList.contains('upvote');
                        votePost(postId, isUpvote);
                    });
                });
                
                document.querySelectorAll('.comments-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (userManager.isBanned) {
                            showSyncStatus('Вы забанены и не можете просматривать комментарии', false);
                            return;
                        }
                        const postId = this.getAttribute('data-post-id');
                        const commentsSection = document.getElementById(`comments-${postId}`);
                        if (commentsSection) {
                            commentsSection.style.display = commentsSection.style.display === 'block' ? 'none' : 'block';
                        }
                    });
                });
                
                document.querySelectorAll('.submit-comment-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (userManager.isBanned) {
                            showSyncStatus('Вы забанены и не можете оставлять комментарии', false);
                            return;
                        }
                        
                        const postId = this.getAttribute('data-post-id');
                        const textarea = document.querySelector(`.comment-textarea[data-post-id="${postId}"]`);
                        if (textarea) {
                            const commentText = textarea.value.trim();
                            if (commentText) {
                                addComment(postId, commentText);
                                textarea.value = '';
                            }
                        }
                    });
                });
                
                document.querySelectorAll('.delete-post-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        if (userManager.isBanned) {
                            showSyncStatus('Вы забанены и не можете удалять посты', false);
                            return;
                        }
                        
                        const postId = this.getAttribute('data-post-id');
                        const isOwner = userManager.isOwner;
                        const post = allPosts.find(p => p.id === postId);
                        const isAuthor = post && userManager.isAuthorOfPost(post);
                        
                        postToDelete = postId;
                        
                        if (isOwner && !isAuthor) {
                            deleteConfirmText.textContent = 'Вы действуете как владелец. Удалить этот пост?';
                        } else {
                            deleteConfirmText.textContent = 'Вы уверены, что хотите удалить этот пост? Это действие нельзя отменить.';
                        }
                        
                        deleteConfirmModal.style.display = 'flex';
                    });
                });
                
                document.querySelectorAll('.ban-user-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const userId = this.getAttribute('data-user-id');
                        const username = this.getAttribute('data-username');
                        
                        userToBan = userId;
                        banConfirmText.textContent = `Вы уверены, что хотите забанить пользователя "${username}"?`;
                        banConfirmModal.style.display = 'flex';
                    });
                });
            }
            
            // Функция создания поста
            async function createPost(title, content, category) {
                try {
                    showSyncStatus('Создание поста...', true);
                    const author = userManager.getUsername();
                    const authorId = userManager.getUserId();
                    const post = await jsonBinApp.addPost(title, content, author, authorId, category);
                    await loadPosts(); // Это обновит и статистику сообществ
                    showSyncStatus('Пост успешно создан', true);
                    
                } catch (error) {
                    console.error('Ошибка создания поста:', error);
                    
                    if (error.message.includes('BLOCKED_CONTENT')) {
                        showSyncStatus('Пост сохранен локально (обнаружены запрещенные слова)', false);
                        await loadPosts(); // Обновляем статистику даже для локальных постов
                    } else {
                        showSyncStatus(`Ошибка создания поста: ${error.message}`, false);
                    }
                    throw error;
                }
            }
            
            // Функция голосования за пост
            async function votePost(postId, isUpvote) {
                try {
                    await jsonBinApp.vote(postId, isUpvote);
                    await loadPosts();
                    showSyncStatus('Голос учтен', true);
                } catch (error) {
                    console.error('Ошибка голосования:', error);
                    showSyncStatus('Ошибка голосования', false);
                }
            }
            
            // Функция добавления комментария
            async function addComment(postId, text) {
                try {
                    const author = userManager.getUsername();
                    const authorId = userManager.getUserId();
                    await jsonBinApp.addComment(postId, text, author, authorId);
                    await loadPosts();
                    showSyncStatus('Комментарий добавлен', true);
                    
                    const commentsSection = document.getElementById(`comments-${postId}`);
                    if (commentsSection) {
                        commentsSection.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Ошибка добавления комментария:', error);
                    showSyncStatus(`Ошибка добавления комментария: ${error.message}`, false);
                }
            }
            
            // Функция удаления поста
            async function deletePost(postId) {
                try {
                    showSyncStatus('Удаление поста...', true);
                    await jsonBinApp.deletePost(postId);
                    await loadPosts();
                    showSyncStatus('Пост успешно удален', true);
                } catch (error) {
                    console.error('Ошибка удаления поста:', error);
                    showSyncStatus('Ошибка удаления поста', false);
                    throw error;
                }
            }
            
            // Функция бана пользователя
            async function banUser(userId) {
                try {
                    showSyncStatus('Бан пользователя...', true);
                    await jsonBinApp.banUser(userId);
                    showSyncStatus('Пользователь забанен', true);
                } catch (error) {
                    console.error('Ошибка бана пользователя:', error);
                    showSyncStatus('Ошибка бана пользователя', false);
                    throw error;
                }
            }
            
            // Функция экспорта данных
            async function exportData() {
                try {
                    const posts = await jsonBinApp.getPosts();
                    const dataStr = JSON.stringify(posts, null, 2);
                    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
                    
                    const exportFileDefaultName = 'localotvet_data.json';
                    
                    const linkElement = document.createElement('a');
                    linkElement.setAttribute('href', dataUri);
                    linkElement.setAttribute('download', exportFileDefaultName);
                    linkElement.click();
                    
                    showSyncStatus('Данные экспортированы', true);
                } catch (error) {
                    console.error('Ошибка экспорта:', error);
                    showSyncStatus('Ошибка экспорта данных', false);
                }
            }
            
            // Функция импорта данных
            async function importData() {
                try {
                    const importDataText = document.getElementById('importData').value;
                    
                    if (!importDataText) {
                        alert('Введите данные для импорта');
                        return;
                    }
                    
                    const importedData = JSON.parse(importDataText);
                    
                    if (Array.isArray(importedData)) {
                        if (confirm('Это заменит все текущие данные в Supabase. Продолжить?')) {
                            showSyncStatus('Импорт данных...', true);
                            // Удаляем все существующие посты
                            await jsonBinApp.nukeAllPosts();
                            
                            // Импортируем новые посты
                            for (const post of importedData) {
                                try {
                                    await jsonBinApp.addPost(
                                        post.title,
                                        post.content,
                                        post.author,
                                        post.authorId,
                                        post.category
                                    );
                                } catch (error) {
                                    console.error('Ошибка импорта поста:', error);
                                }
                            }
                            
                            await loadPosts();
                            importDataModal.style.display = 'none';
                            document.getElementById('importData').value = '';
                            showSyncStatus('Данные успешно импортированы в Supabase', true);
                        }
                    } else {
                        alert('Некорректный формат данных. Ожидается массив.');
                    }
                } catch (e) {
                    alert('Ошибка при разборе JSON: ' + e.message);
                    showSyncStatus('Ошибка импорта данных', false);
                }
            }
        });
    </script>
</body>
</html>
